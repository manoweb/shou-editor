!function(e){"use strict";const t=(e,t=document)=>t.querySelector(e),s=(e,t=document)=>[...t.querySelectorAll(e)];function o(e,t,s,o){e&&("function"==typeof s?e.addEventListener(t,s):e.addEventListener(t,t=>{const a=t.target.closest(s);a&&e.contains(a)&&o.call(a,t,a)}))}function a(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}function n(e){return{start:e.selectionStart,end:e.selectionEnd}}function l(e,t,s=t){e.focus(),e.setSelectionRange(t,s)}let i="en";const r={en:{"btn.new":"New","btn.open":"Open","btn.save":"Save","btn.export":"Export","btn.theme":"Theme","btn.fullscreen":"Fullscreen","btn.toggleOutlines":"Show container outlines","view.code":"Code","panel.blocks":"Blocks","panel.layers":"Layers","panel.styles":"Styles","panel.settings":"Settings","empty.dragElements":"Drag elements","empty.selectElement":"Select an element","styles.dimensions":"Dimensions","styles.spacing":"Spacing","styles.typography":"Typography","styles.background":"Background","styles.borders":"Borders","styles.layout":"Layout","styles.flexbox":"Flexbox","styles.grid":"Grid","styles.transform":"Transform & Effects","toolbar.drag":"Drag to move","toolbar.duplicate":"Duplicate","toolbar.delete":"Delete","toolbar.editImage":"Edit image","toolbar.moveUp":"Move up","toolbar.moveDown":"Move down","toolbar.moveOut":"Move to parent","toolbar.moveInto":"Move into container","confirm.newProject":"Create new project?","options.add":"+ Option","options.valuePlaceholder":"value","options.textPlaceholder":"text","setting.label":"Label","setting.name":"Name","setting.type":"Type","setting.placeholder":"Placeholder","setting.value":"Value","setting.required":"Required","setting.readonly":"Readonly","setting.disabled":"Disabled","setting.classes":"Classes","setting.id":"ID","setting.options":"Options","setting.checked":"Checked","setting.text":"Text","setting.multiple":"Multiple","setting.accept":"Accept","setting.min":"Min","setting.max":"Max","setting.step":"Step","setting.rows":"Rows","setting.title":"Title","setting.subtitle":"Subtitle","setting.content":"Content","setting.buttonText":"Button text","setting.buttonUrl":"Button URL","setting.variant":"Variant","setting.brand":"Brand","setting.links":"Links","setting.level":"Level","setting.width":"Width","setting.height":"Height","setting.src":"Source","setting.alt":"Alt text","setting.url":"URL","setting.target":"Target","setting.action":"Action","setting.method":"Method","setting.footerText":"Footer text","setting.slides":"Slides","setting.addSlide":"+ Add slide","setting.slideUrl":"Image URL","setting.slideAlt":"Alt text","setting.tabs":"Tabs","setting.addTab":"+ Add tab","setting.tabTitle":"Tab title","setting.tabContent":"Content","setting.modalSize":"Size","setting.modalCentered":"Vertically centered","setting.modalScrollable":"Scrollable","setting.modalStaticBackdrop":"Static backdrop","setting.closeButton":"Close button","setting.saveButton":"Save button","setting.showCloseBtn":"Show close","setting.showSaveBtn":"Show save","setting.accordion":"Sections","setting.addSection":"+ Add section","setting.sectionTitle":"Section title","setting.listItems":"Items","setting.addItem":"+ Add item","setting.itemText":"Text","setting.breadcrumbLinks":"Links","setting.addLink":"+ Add link","setting.linkText":"Text","setting.linkUrl":"URL"},es:{"btn.new":"Nuevo","btn.open":"Abrir","btn.save":"Guardar","btn.export":"Exportar","btn.theme":"Tema","btn.fullscreen":"Pantalla completa","btn.toggleOutlines":"Mostrar contornos de contenedores","view.code":"Código","panel.blocks":"Bloques","panel.layers":"Capas","panel.styles":"Estilos","panel.settings":"Ajustes","empty.dragElements":"Arrastra elementos","empty.selectElement":"Selecciona un elemento","styles.dimensions":"Dimensiones","styles.spacing":"Espaciado","styles.typography":"Tipografía","styles.background":"Fondo","styles.borders":"Bordes","styles.layout":"Diseño","styles.flexbox":"Flexbox","styles.grid":"Grid","styles.transform":"Transformaciones y Efectos","toolbar.drag":"Arrastrar para mover","toolbar.duplicate":"Duplicar","toolbar.delete":"Eliminar","toolbar.editImage":"Editar imagen","toolbar.moveUp":"Mover arriba","toolbar.moveDown":"Mover abajo","toolbar.moveOut":"Sacar del contenedor","toolbar.moveInto":"Meter en contenedor","confirm.newProject":"¿Crear nuevo proyecto?","options.add":"+ Opción","options.valuePlaceholder":"valor","options.textPlaceholder":"texto","setting.label":"Etiqueta","setting.name":"Nombre","setting.type":"Tipo","setting.placeholder":"Placeholder","setting.value":"Valor","setting.required":"Requerido","setting.readonly":"Readonly","setting.disabled":"Deshabilitado","setting.classes":"Clases","setting.id":"ID","setting.options":"Opciones","setting.checked":"Checked","setting.text":"Texto","setting.multiple":"Múltiple","setting.accept":"Aceptar","setting.min":"Mín","setting.max":"Máx","setting.step":"Paso","setting.rows":"Filas","setting.title":"Título","setting.subtitle":"Subtítulo","setting.content":"Contenido","setting.buttonText":"Botón texto","setting.buttonUrl":"Botón URL","setting.variant":"Variante","setting.brand":"Marca","setting.links":"Enlaces","setting.level":"Nivel","setting.width":"Ancho","setting.height":"Alto","setting.src":"Fuente","setting.alt":"Texto alt","setting.url":"URL","setting.target":"Target","setting.action":"Acción","setting.method":"Método","setting.footerText":"Texto pie","setting.slides":"Slides","setting.addSlide":"+ Añadir slide","setting.slideUrl":"URL imagen","setting.slideAlt":"Texto alt","setting.tabs":"Pestañas","setting.addTab":"+ Añadir pestaña","setting.tabTitle":"Título","setting.tabContent":"Contenido","setting.modalSize":"Tamaño","setting.modalCentered":"Centrado vertical","setting.modalScrollable":"Scrollable","setting.modalStaticBackdrop":"Fondo estático","setting.closeButton":"Botón cerrar","setting.saveButton":"Botón guardar","setting.showCloseBtn":"Mostrar cerrar","setting.showSaveBtn":"Mostrar guardar","setting.accordion":"Secciones","setting.addSection":"+ Añadir sección","setting.sectionTitle":"Título sección","setting.listItems":"Elementos","setting.addItem":"+ Añadir elemento","setting.itemText":"Texto","setting.breadcrumbLinks":"Enlaces","setting.addLink":"+ Añadir enlace","setting.linkText":"Texto","setting.linkUrl":"URL"}};function c(e){return r[i]&&r[i][e]||r.en[e]||e}const d=(e,t="0 0 24 24")=>`<svg viewBox="${t}" fill="currentColor" xmlns="http://www.w3.org/2000/svg">${e}</svg>`,p={fileNew:d('<path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6zm-1 2l5 5h-5V4zM6 20V4h5v7h7v9H6zm5-5v-2h2v2h2v2h-2v2h-2v-2H9v-2h2z"/>'),folderOpen:d('<path d="M20 6h-8l-2-2H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2zm0 12H4V8h16v10z"/>'),save:d('<path d="M17 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V7l-4-4zm-5 16a3 3 0 1 1 0-6 3 3 0 0 1 0 6zm3-10H7V5h8v4z"/>'),desktop:d('<path d="M21 2H3a1 1 0 0 0-1 1v13a1 1 0 0 0 1 1h7v2H8v2h8v-2h-2v-2h7a1 1 0 0 0 1-1V3a1 1 0 0 0-1-1zm-1 12H4V4h16v10z"/>'),tablet:d('<path d="M18 0H6a2 2 0 0 0-2 2v20a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zm-3 22H9v-1h6v1zm3-3H6V3h12v16z"/>'),mobile:d('<path d="M17 1H7a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2zm-3 20h-4v-1h4v1zm3-3H7V4h10v14z"/>'),preview:d('<path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zm0 12.5a5 5 0 1 1 0-10 5 5 0 0 1 0 10zm0-8a3 3 0 1 0 0 6 3 3 0 0 0 0-6z"/>'),download:d('<path d="M19 9h-4V3H9v6H5l7 7 7-7zm-14 9v2h14v-2H5z"/>'),theme:d('<path d="M12 3a9 9 0 1 0 0 18 9 9 0 0 0 0-18zm0 16V5a7 7 0 0 1 0 14z"/>'),outlines:d('<path d="M3 3h18v18H3V3zm2 2v14h14V5H5z" fill-rule="evenodd"/><path d="M7 7h4v4H7zm6 0h4v4h-4zm-6 6h4v4H7zm6 0h4v4h-4z" opacity=".3"/>'),fullscreen:d('<path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/>'),exitFullscreen:d('<path d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"/>'),text:d('<path d="M5 4v3h5.5v12h3V7H19V4H5z"/>'),heading:d('<path d="M5 4v16h3v-6h8v6h3V4h-3v7H8V4H5z"/>'),image:d('<path d="M21 3H3a1 1 0 0 0-1 1v16a1 1 0 0 0 1 1h18a1 1 0 0 0 1-1V4a1 1 0 0 0-1-1zm-1 16H4V5h16v14z"/><circle cx="8.5" cy="8.5" r="1.5"/><path d="M4 18l4-5 3 3 4-5 5 7H4z"/>'),link:d('<path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7a5 5 0 0 0 0 10h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4a5 5 0 0 0 0-10z"/>'),divider:d('<path d="M2 11h20v2H2z"/>'),container:d('<path d="M3 3h18v18H3V3zm2 2v14h14V5H5z"/>'),columns2:d('<path d="M3 3h18v18H3V3zm2 2v14h6V5H5zm8 0v14h6V5h-6z"/>'),columns3:d('<path d="M3 3h18v18H3V3zm2 2v14h4V5H5zm6 0v14h2V5h-2zm4 0v14h4V5h-4z"/>'),card:d('<path d="M3 3h18v18H3V3zm2 2v14h14V5H5zm0 4h14" fill="none" stroke="currentColor" stroke-width="2"/><path d="M3 3h18v18H3V3zm2 2v14h14V5H5z"/><line x1="5" y1="9" x2="19" y2="9" stroke="currentColor" stroke-width="1.5"/>'),alert:d('<path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/>'),button:d('<rect x="3" y="7" width="18" height="10" rx="5" fill="none" stroke="currentColor" stroke-width="2"/><path d="M8 12h8" stroke="currentColor" stroke-width="2" fill="none"/>'),table:d('<path d="M3 3h18v18H3V3zm2 2v4h6V5H5zm8 0v4h6V5h-6zM5 11v4h6v-4H5zm8 0v4h6v-4h-6zM5 17v2h6v-2H5zm8 0v2h6v-2h-6z"/>'),accordion:d('<path d="M3 3h18v4H3V3zm0 6h18v2H3V9zm0 4h18v2H3v-2zm0 4h18v4H3v-4z" fill="none" stroke="currentColor" stroke-width="1.5"/>'),carousel:d('<path d="M2 6h20v12H2V6zm2 2v8h16V8H4z" fill="none" stroke="currentColor" stroke-width="1.5"/><path d="M7 12l3-3v6l-3-3zm10 0l-3-3v6l3-3z"/>'),modal:d('<path d="M3 5h18v14H3V5zm2 2v10h14V7H5z" fill="none" stroke="currentColor" stroke-width="2"/><path d="M5 7h14v3H5V7z" fill="currentColor" opacity="0.3"/><line x1="17" y1="8" x2="19" y2="10" stroke="currentColor" stroke-width="1.5"/><line x1="19" y1="8" x2="17" y2="10" stroke="currentColor" stroke-width="1.5"/>'),tabs:d('<path d="M3 7h5V3h8v4h5v14H3V7z" fill="none" stroke="currentColor" stroke-width="1.5"/><line x1="8" y1="3" x2="8" y2="7" stroke="currentColor" stroke-width="1.5"/><line x1="16" y1="3" x2="16" y2="7" stroke="currentColor" stroke-width="1.5"/>'),badge:d('<rect x="4" y="8" width="16" height="8" rx="4" fill="none" stroke="currentColor" stroke-width="2"/><circle cx="8" cy="12" r="1.5" fill="currentColor"/>'),progress:d('<rect x="2" y="9" width="20" height="6" rx="3" fill="none" stroke="currentColor" stroke-width="2"/><rect x="2" y="9" width="12" height="6" rx="3" fill="currentColor" opacity="0.4"/>'),listGroup:d('<path d="M4 4h16v3H4V4zm0 5h16v3H4V9zm0 5h16v3H4v-3zm0 5h16v3H4v-3z" fill="none" stroke="currentColor" stroke-width="1.2"/>'),breadcrumb:d('<path d="M3 12h3l3-3v6l-3-3h-3zm7 0h3l3-3v6l-3-3h-3zm7 0h4" stroke="currentColor" stroke-width="2" fill="none"/>'),pagination:d('<rect x="1" y="8" width="6" height="8" rx="1" fill="none" stroke="currentColor" stroke-width="1.5"/><rect x="9" y="8" width="6" height="8" rx="1" fill="currentColor" opacity="0.3" stroke="currentColor" stroke-width="1.5"/><rect x="17" y="8" width="6" height="8" rx="1" fill="none" stroke="currentColor" stroke-width="1.5"/>'),spinner:d('<circle cx="12" cy="12" r="9" fill="none" stroke="currentColor" stroke-width="2.5" opacity="0.2"/><path d="M12 3a9 9 0 0 1 9 9" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/>'),toast:d('<rect x="3" y="5" width="18" height="14" rx="2" fill="none" stroke="currentColor" stroke-width="1.5"/><line x1="3" y1="10" x2="21" y2="10" stroke="currentColor" stroke-width="1.5"/><line x1="18" y1="7" x2="19" y2="8" stroke="currentColor" stroke-width="1.2"/><line x1="19" y1="7" x2="18" y2="8" stroke="currentColor" stroke-width="1.2"/>'),input:d('<rect x="2" y="6" width="20" height="12" rx="2" fill="none" stroke="currentColor" stroke-width="2"/><path d="M6 10v4" stroke="currentColor" stroke-width="2"/>'),textarea:d('<rect x="2" y="3" width="20" height="18" rx="2" fill="none" stroke="currentColor" stroke-width="2"/><path d="M6 7h12M6 11h12M6 15h8" stroke="currentColor" stroke-width="1.5" fill="none"/>'),select:d('<rect x="2" y="6" width="20" height="12" rx="2" fill="none" stroke="currentColor" stroke-width="2"/><path d="M16 10l-4 4-4-4" fill="none" stroke="currentColor" stroke-width="2"/>'),navbar:d('<path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>'),hero:d('<path d="M12 2L2 7v2h20V7L12 2zm-8 9v6l8 5 8-5v-6l-8 4-8-4z"/>'),features:d('<path d="M3 3h7v7H3V3zm11 0h7v7h-7V3zM3 14h7v7H3v-7zm11 0h7v7h-7v-7z"/>'),footer:d('<path d="M3 3h18v18H3V3zm2 2v14h14V5H5zm0 11h14" fill="none" stroke="currentColor" stroke-width="2"/><path d="M3 3h18v18H3V3zm2 2v14h14V5H5z"/><line x1="5" y1="16" x2="19" y2="16" stroke="currentColor" stroke-width="1.5"/>'),drag:d('<path d="M10 9h4V6h3l-5-5-5 5h3v3zm-1 1H6V7l-5 5 5 5v-3h3v-4zm14 2l-5-5v3h-3v4h3v3l5-5zm-9 3h-4v3H7l5 5 5-5h-3v-3z"/>'),duplicate:d('<path d="M16 1H4a2 2 0 0 0-2 2v14h2V3h12V1zm3 4H8a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h11a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2zm0 16H8V7h11v14z"/>'),delete:d('<path d="M6 19a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>'),editImage:d('<path d="M21.28 6.4l-3.68-3.68a1.5 1.5 0 0 0-2.12 0L3 15.2V21h5.8L21.28 8.52a1.5 1.5 0 0 0 0-2.12zM8.27 19H5v-3.27L16.03 4.7l3.27 3.27L8.27 19z"/>'),moveUp:d('<path d="M7 14l5-5 5 5z"/>'),moveDown:d('<path d="M7 10l5 5 5-5z"/>'),moveOut:d('<path d="M14 7l-5 5 5 5z"/>'),moveInto:d('<path d="M10 7l5 5-5 5z"/>'),chevron:d('<path d="M7 10l5 5 5-5z"/>')},h=new Set(["required","disabled","checked","selected","controls","autoplay","loop","muted","async","defer","reversed","hidden","readonly","multiple","novalidate","open","autofocus","allowfullscreen","playsinline","default","formnovalidate","draggable","contenteditable","spellcheck"]),b={_common:["id","class","title","style","role","tabindex","lang","dir","hidden","draggable","contenteditable","spellcheck"],a:["href","target","rel","download","hreflang","type"],abbr:[],area:["shape","coords","href","target","alt","rel"],audio:["src","controls","autoplay","loop","muted","preload","crossorigin"],blockquote:["cite"],button:["type","disabled","name","value","form","autofocus"],canvas:["width","height"],col:["span"],colgroup:["span"],del:["cite","datetime"],details:["open"],dialog:["open"],embed:["src","type","width","height"],fieldset:["disabled","name","form"],form:["action","method","novalidate","enctype","target","autocomplete","name"],iframe:["src","width","height","name","sandbox","allow","loading","allowfullscreen"],img:["src","alt","width","height","loading","srcset","sizes","crossorigin","decoding","usemap"],input:["type","name","placeholder","value","required","disabled","readonly","checked","min","max","step","pattern","minlength","maxlength","autocomplete","autofocus","form","list","multiple","accept","size"],ins:["cite","datetime"],label:["for"],li:["value"],map:["name"],meter:["value","min","max","low","high","optimum"],object:["data","type","width","height","name","form"],ol:["type","start","reversed"],optgroup:["label","disabled"],option:["value","selected","disabled","label"],output:["for","name","form"],progress:["value","max"],q:["cite"],select:["name","required","multiple","disabled","size","autocomplete","autofocus","form"],source:["src","type","srcset","sizes","media"],table:["border"],td:["colspan","rowspan","headers"],textarea:["name","placeholder","rows","cols","required","readonly","disabled","minlength","maxlength","wrap","autocomplete","autofocus","form"],th:["colspan","rowspan","scope","headers","abbr"],time:["datetime"],track:["src","kind","srclang","label","default"],video:["src","controls","autoplay","loop","muted","poster","width","height","preload","playsinline","crossorigin"]},u={sections:[{id:"dimensions",label:"styles.dimensions",props:[{label:"Width",style:"width",type:"text"},{label:"Height",style:"height",type:"text"},{label:"Min Width",style:"minWidth",type:"text"},{label:"Max Width",style:"maxWidth",type:"text"},{label:"Min Height",style:"minHeight",type:"text"},{label:"Max Height",style:"maxHeight",type:"text"},{label:"Overflow",style:"overflow",type:"select",options:["","visible","hidden","scroll","auto"]}]},{id:"spacing",label:"styles.spacing",props:[{label:"Margin",style:"margin",type:"text"},{label:"Margin Top",style:"marginTop",type:"text"},{label:"Margin Right",style:"marginRight",type:"text"},{label:"Margin Bottom",style:"marginBottom",type:"text"},{label:"Margin Left",style:"marginLeft",type:"text"},{label:"Padding",style:"padding",type:"text"},{label:"Padding Top",style:"paddingTop",type:"text"},{label:"Padding Right",style:"paddingRight",type:"text"},{label:"Padding Bottom",style:"paddingBottom",type:"text"},{label:"Padding Left",style:"paddingLeft",type:"text"}]},{id:"typography",label:"styles.typography",props:[{label:"Font Family",style:"fontFamily",type:"text"},{label:"Font Size",style:"fontSize",type:"text"},{label:"Font Weight",style:"fontWeight",type:"select",options:["","100","200","300","400","500","600","700","800","900","bold","normal"]},{label:"Font Style",style:"fontStyle",type:"select",options:["","normal","italic"]},{label:"Line Height",style:"lineHeight",type:"text"},{label:"Letter Spacing",style:"letterSpacing",type:"text"},{label:"Text Align",style:"textAlign",type:"select",options:["","left","center","right","justify"]},{label:"Text Decoration",style:"textDecoration",type:"select",options:["","none","underline","line-through","overline"]},{label:"Text Transform",style:"textTransform",type:"select",options:["","none","uppercase","lowercase","capitalize"]},{label:"White Space",style:"whiteSpace",type:"select",options:["","normal","nowrap","pre","pre-wrap","pre-line"]},{label:"Word Break",style:"wordBreak",type:"select",options:["","normal","break-all","keep-all","break-word"]},{label:"Color",style:"color",type:"color"}]},{id:"background",label:"styles.background",props:[{label:"BG Color",style:"backgroundColor",type:"color"},{label:"BG Image",style:"backgroundImage",type:"text",placeholder:"url(...)"},{label:"BG Size",style:"backgroundSize",type:"select",options:["","cover","contain","auto","100% 100%"]},{label:"BG Position",style:"backgroundPosition",type:"select",options:["","center","top","bottom","left","right","center center","top center","bottom center"]},{label:"BG Repeat",style:"backgroundRepeat",type:"select",options:["","repeat","no-repeat","repeat-x","repeat-y"]},{label:"Opacity",style:"opacity",type:"text",placeholder:"0-1"}]},{id:"borders",label:"styles.borders",props:[{label:"Border",style:"border",type:"text"},{label:"Border Top",style:"borderTop",type:"text"},{label:"Border Right",style:"borderRight",type:"text"},{label:"Border Bottom",style:"borderBottom",type:"text"},{label:"Border Left",style:"borderLeft",type:"text"},{label:"Border Color",style:"borderColor",type:"color"},{label:"Radius",style:"borderRadius",type:"text"},{label:"Outline",style:"outline",type:"text"},{label:"Box Shadow",style:"boxShadow",type:"text",placeholder:"0 2px 4px rgba(0,0,0,.2)"}]},{id:"layout",label:"styles.layout",props:[{label:"Display",style:"display",type:"select",options:["","block","inline","inline-block","flex","inline-flex","grid","inline-grid","none"]},{label:"Position",style:"position",type:"select",options:["","static","relative","absolute","fixed","sticky"]},{label:"Top",style:"top",type:"text"},{label:"Right",style:"right",type:"text"},{label:"Bottom",style:"bottom",type:"text"},{label:"Left",style:"left",type:"text"},{label:"Z-Index",style:"zIndex",type:"text"},{label:"Float",style:"float",type:"select",options:["","none","left","right"]},{label:"Clear",style:"clear",type:"select",options:["","none","left","right","both"]},{label:"Visibility",style:"visibility",type:"select",options:["","visible","hidden","collapse"]},{label:"Cursor",style:"cursor",type:"select",options:["","auto","default","pointer","move","text","wait","crosshair","not-allowed","grab","grabbing"]}]},{id:"flexbox",label:"styles.flexbox",props:[{label:"Flex Direction",style:"flexDirection",type:"select",options:["","row","row-reverse","column","column-reverse"]},{label:"Flex Wrap",style:"flexWrap",type:"select",options:["","nowrap","wrap","wrap-reverse"]},{label:"Justify Content",style:"justifyContent",type:"select",options:["","flex-start","flex-end","center","space-between","space-around","space-evenly"]},{label:"Align Items",style:"alignItems",type:"select",options:["","stretch","flex-start","flex-end","center","baseline"]},{label:"Align Content",style:"alignContent",type:"select",options:["","stretch","flex-start","flex-end","center","space-between","space-around"]},{label:"Gap",style:"gap",type:"text"},{label:"Flex",style:"flex",type:"text"},{label:"Flex Grow",style:"flexGrow",type:"text"},{label:"Flex Shrink",style:"flexShrink",type:"text"},{label:"Flex Basis",style:"flexBasis",type:"text"},{label:"Align Self",style:"alignSelf",type:"select",options:["","auto","flex-start","flex-end","center","baseline","stretch"]},{label:"Order",style:"order",type:"text"}]},{id:"grid",label:"styles.grid",props:[{label:"Grid Columns",style:"gridTemplateColumns",type:"text",placeholder:"1fr 1fr 1fr"},{label:"Grid Rows",style:"gridTemplateRows",type:"text"},{label:"Grid Column",style:"gridColumn",type:"text"},{label:"Grid Row",style:"gridRow",type:"text"},{label:"Grid Gap",style:"gap",type:"text"},{label:"Place Items",style:"placeItems",type:"text"},{label:"Place Content",style:"placeContent",type:"text"}]},{id:"transform",label:"styles.transform",props:[{label:"Transform",style:"transform",type:"text",placeholder:"rotate(0deg) scale(1)"},{label:"Transform Origin",style:"transformOrigin",type:"text"},{label:"Transition",style:"transition",type:"text",placeholder:"all 0.3s ease"},{label:"Animation",style:"animation",type:"text"},{label:"Filter",style:"filter",type:"text",placeholder:"blur(0px) brightness(100%)"}]}]},g={basic:[{id:"text",label:"Texto",icon:p.text,html:"<p>Escribe tu texto aquí...</p>",settings:[{label:"setting.id",attr:"id",type:"text"},{label:"setting.classes",attr:"class",type:"text"}]},{id:"heading",label:"Título",icon:p.heading,html:"<h2>Título de sección</h2>",settings:[{label:"setting.level",prop:"tagName",type:"select",options:["H1","H2","H3","H4","H5","H6"]},{label:"setting.id",attr:"id",type:"text"},{label:"setting.classes",attr:"class",type:"text"}]},{id:"image",label:"Imagen",icon:p.image,html:'<img src="https://picsum.photos/1900/1000" alt="Imagen" class="img-fluid">',settings:[{label:"setting.src",attr:"src",type:"text"},{label:"setting.alt",attr:"alt",type:"text"},{label:"setting.width",attr:"width",type:"text"},{label:"setting.height",attr:"height",type:"text"},{label:"Loading",attr:"loading",type:"select",options:["","lazy","eager"]},{label:"setting.classes",attr:"class",type:"text"}]},{id:"link",label:"Enlace",icon:p.link,html:'<a href="#">Enlace de ejemplo</a>',settings:[{label:"setting.url",attr:"href",type:"text"},{label:"setting.target",attr:"target",type:"select",options:["","_blank","_self","_parent","_top"]},{label:"Rel",attr:"rel",type:"text"},{label:"setting.id",attr:"id",type:"text"},{label:"setting.classes",attr:"class",type:"text"}]},{id:"divider",label:"Divisor",icon:p.divider,html:'<hr class="my-4">',settings:[{label:"setting.classes",attr:"class",type:"text"}]}],layout:[{id:"container",label:"Container",icon:p.container,html:'<div class="container py-4"><p>Contenido...</p></div>',settings:[{label:"setting.type",attr:"class",type:"select",options:["container py-4","container-fluid py-4","container-sm py-4","container-md py-4","container-lg py-4","container-xl py-4"]},{label:"setting.id",attr:"id",type:"text"}]},{id:"row-2",label:"2 Columnas",icon:p.columns2,html:'<div class="row"><div class="col-6"><div class="p-3 bg-light">Col 1</div></div><div class="col-6"><div class="p-3 bg-light">Col 2</div></div></div>',settings:[{label:"setting.classes",attr:"class",type:"text"},{label:"setting.id",attr:"id",type:"text"}]},{id:"row-3",label:"3 Columnas",icon:p.columns3,html:'<div class="row"><div class="col-4"><div class="p-3 bg-light">1</div></div><div class="col-4"><div class="p-3 bg-light">2</div></div><div class="col-4"><div class="p-3 bg-light">3</div></div></div>',settings:[{label:"setting.classes",attr:"class",type:"text"},{label:"setting.id",attr:"id",type:"text"}]}],bootstrap:[{id:"card",label:"Card",icon:p.card,html:'<div class="card"><div class="card-body"><h5 class="card-title">Card</h5><p class="card-text">Contenido de la card.</p><a href="#" class="btn btn-primary">Acción</a></div></div>',settings:[{label:"setting.title",prop:"textContent",selector:".card-title",type:"text"},{label:"setting.text",prop:"textContent",selector:".card-text",type:"text"},{label:"setting.buttonText",prop:"textContent",selector:".btn",type:"text"},{label:"setting.buttonUrl",attr:"href",selector:".btn",type:"text"},{label:"setting.classes",attr:"class",type:"text"}]},{id:"alert",label:"Alerta",icon:p.alert,html:'<div class="alert alert-primary">Mensaje de alerta</div>',settings:[{label:"setting.variant",attr:"class",type:"select",options:["alert alert-primary","alert alert-secondary","alert alert-success","alert alert-danger","alert alert-warning","alert alert-info","alert alert-light","alert alert-dark"]},{label:"setting.id",attr:"id",type:"text"}]},{id:"button",label:"Botón",icon:p.button,html:'<button class="btn btn-primary">Botón</button>',settings:[{label:"setting.variant",attr:"class",type:"select",options:["btn btn-primary","btn btn-secondary","btn btn-success","btn btn-danger","btn btn-warning","btn btn-info","btn btn-light","btn btn-dark","btn btn-outline-primary","btn btn-outline-secondary","btn btn-outline-success","btn btn-outline-danger"]},{label:"setting.type",attr:"type",type:"select",options:["button","submit","reset"]},{label:"setting.disabled",attr:"disabled",type:"checkbox"}]},{id:"table",label:"Tabla",icon:p.table,html:'<table class="table"><thead><tr><th>#</th><th>Nombre</th></tr></thead><tbody><tr><td>1</td><td>Ejemplo</td></tr></tbody></table>',settings:[{label:"setting.classes",attr:"class",type:"text"},{label:"setting.id",attr:"id",type:"text"}]},{id:"accordion",label:"Accordion",icon:p.accordion,html:'<div class="shou-accordion-wrapper"><div class="accordion" id="acc1"><div class="accordion-item"><h2 class="accordion-header"><button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#acc1-c1">Sección 1</button></h2><div id="acc1-c1" class="accordion-collapse collapse show" data-bs-parent="#acc1"><div class="accordion-body">Contenido de la primera sección.</div></div></div><div class="accordion-item"><h2 class="accordion-header"><button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#acc1-c2">Sección 2</button></h2><div id="acc1-c2" class="accordion-collapse collapse" data-bs-parent="#acc1"><div class="accordion-body">Contenido de la segunda sección.</div></div></div><div class="accordion-item"><h2 class="accordion-header"><button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#acc1-c3">Sección 3</button></h2><div id="acc1-c3" class="accordion-collapse collapse" data-bs-parent="#acc1"><div class="accordion-body">Contenido de la tercera sección.</div></div></div></div></div>',settings:[{label:"setting.accordion",type:"accordion"},{label:"setting.id",attr:"id",selector:".accordion",type:"text"},{label:"setting.classes",attr:"class",type:"text"}]},{id:"carousel",label:"Carousel",icon:p.carousel,html:'<div id="carousel1" class="carousel slide" data-bs-ride="carousel"><div class="carousel-indicators"><button type="button" data-bs-target="#carousel1" data-bs-slide-to="0" class="active"></button><button type="button" data-bs-target="#carousel1" data-bs-slide-to="1"></button><button type="button" data-bs-target="#carousel1" data-bs-slide-to="2"></button></div><div class="carousel-inner"><div class="carousel-item active"><img src="https://picsum.photos/1200/500?random=1" class="d-block w-100" alt="Slide 1"></div><div class="carousel-item"><img src="https://picsum.photos/1200/500?random=2" class="d-block w-100" alt="Slide 2"></div><div class="carousel-item"><img src="https://picsum.photos/1200/500?random=3" class="d-block w-100" alt="Slide 3"></div></div><button class="carousel-control-prev" type="button" data-bs-target="#carousel1" data-bs-slide="prev"><span class="carousel-control-prev-icon"></span></button><button class="carousel-control-next" type="button" data-bs-target="#carousel1" data-bs-slide="next"><span class="carousel-control-next-icon"></span></button></div>',settings:[{label:"setting.slides",type:"slides"},{label:"setting.id",attr:"id",type:"text"},{label:"setting.classes",attr:"class",type:"text"}]},{id:"modal",label:"Modal",icon:p.modal,html:'<div class="shou-modal-wrapper"><button type="button" class="btn btn-primary shou-modal-trigger">Abrir modal</button><div class="modal fade show shou-modal-overlay" style="display:none;position:fixed;top:0;left:0;right:0;bottom:0;z-index:1050;background:rgba(0,0,0,0.5)"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">Título del modal</h5><button type="button" class="btn-close shou-modal-close-x"></button></div><div class="modal-body" style="min-height:100px"><p class="text-muted">Arrastra bloques aquí</p></div><div class="modal-footer"><button type="button" class="btn btn-secondary shou-modal-close">Cerrar</button><button type="button" class="btn btn-primary shou-modal-save">Guardar</button></div></div></div></div></div>',settings:[{label:"setting.title",prop:"textContent",selector:".modal-title",type:"text"},{label:"setting.buttonText",prop:"textContent",selector:".shou-modal-trigger",type:"text"},{label:"setting.modalSize",attr:"class",selector:".modal-dialog",type:"select",options:["modal-dialog","modal-dialog modal-sm","modal-dialog modal-lg","modal-dialog modal-xl","modal-dialog modal-fullscreen"]},{label:"setting.modalCentered",type:"modal-toggle",prop:"centered"},{label:"setting.modalScrollable",type:"modal-toggle",prop:"scrollable"},{label:"setting.closeButton",prop:"textContent",selector:".shou-modal-close",type:"text"},{label:"setting.showCloseBtn",type:"modal-toggle",prop:"showClose"},{label:"setting.saveButton",prop:"textContent",selector:".shou-modal-save",type:"text"},{label:"setting.showSaveBtn",type:"modal-toggle",prop:"showSave"},{label:"setting.id",attr:"id",type:"text"}]},{id:"tabs",label:"Tabs",icon:p.tabs,html:'<div class="shou-tabs-wrapper"><ul class="nav nav-tabs" id="tabs1" role="tablist"><li class="nav-item" role="presentation"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#tabs1-1" type="button" role="tab">Pestaña 1</button></li><li class="nav-item" role="presentation"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tabs1-2" type="button" role="tab">Pestaña 2</button></li><li class="nav-item" role="presentation"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tabs1-3" type="button" role="tab">Pestaña 3</button></li></ul><div class="tab-content p-3 border border-top-0 rounded-bottom"><div class="tab-pane fade show active" id="tabs1-1" role="tabpanel">Contenido de la pestaña 1.</div><div class="tab-pane fade" id="tabs1-2" role="tabpanel">Contenido de la pestaña 2.</div><div class="tab-pane fade" id="tabs1-3" role="tabpanel">Contenido de la pestaña 3.</div></div></div>',settings:[{label:"setting.tabs",type:"tabs"},{label:"setting.id",attr:"id",selector:".nav-tabs",type:"text"},{label:"setting.classes",attr:"class",type:"text"}]},{id:"badge",label:"Badge",icon:p.badge,html:'<span class="badge bg-primary">Badge</span>',settings:[{label:"setting.variant",attr:"class",type:"select",options:["badge bg-primary","badge bg-secondary","badge bg-success","badge bg-danger","badge bg-warning text-dark","badge bg-info text-dark","badge bg-light text-dark","badge bg-dark","badge rounded-pill bg-primary","badge rounded-pill bg-secondary","badge rounded-pill bg-success","badge rounded-pill bg-danger"]}]},{id:"progress",label:"Progress",icon:p.progress,html:'<div class="progress" role="progressbar" style="height:20px"><div class="progress-bar" style="width:50%">50%</div></div>',settings:[{label:"setting.value",attr:"style",selector:".progress-bar",type:"text"},{label:"setting.text",prop:"textContent",selector:".progress-bar",type:"text"},{label:"setting.variant",attr:"class",selector:".progress-bar",type:"select",options:["progress-bar","progress-bar bg-success","progress-bar bg-info","progress-bar bg-warning","progress-bar bg-danger","progress-bar progress-bar-striped","progress-bar progress-bar-striped progress-bar-animated"]},{label:"setting.classes",attr:"class",type:"text"}]},{id:"list-group",label:"List Group",icon:p.listGroup,html:'<div class="shou-listgroup-wrapper"><ul class="list-group"><li class="list-group-item">Elemento 1</li><li class="list-group-item">Elemento 2</li><li class="list-group-item">Elemento 3</li></ul></div>',settings:[{label:"setting.listItems",type:"listgroup"},{label:"setting.variant",attr:"class",selector:".list-group",type:"select",options:["list-group","list-group list-group-flush","list-group list-group-numbered"]},{label:"setting.id",attr:"id",selector:".list-group",type:"text"},{label:"setting.classes",attr:"class",type:"text"}]},{id:"breadcrumb",label:"Breadcrumb",icon:p.breadcrumb,html:'<div class="shou-breadcrumb-wrapper"><nav aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="#">Inicio</a></li><li class="breadcrumb-item"><a href="#">Sección</a></li><li class="breadcrumb-item active" aria-current="page">Página actual</li></ol></nav></div>',settings:[{label:"setting.breadcrumbLinks",type:"breadcrumb"},{label:"setting.classes",attr:"class",selector:".breadcrumb",type:"text"},{label:"setting.id",attr:"id",type:"text"}]},{id:"pagination",label:"Pagination",icon:p.pagination,html:'<nav aria-label="Paginación"><ul class="pagination"><li class="page-item"><a class="page-link" href="#">&laquo;</a></li><li class="page-item active"><a class="page-link" href="#">1</a></li><li class="page-item"><a class="page-link" href="#">2</a></li><li class="page-item"><a class="page-link" href="#">3</a></li><li class="page-item"><a class="page-link" href="#">&raquo;</a></li></ul></nav>',settings:[{label:"setting.variant",attr:"class",selector:".pagination",type:"select",options:["pagination","pagination pagination-sm","pagination pagination-lg","pagination justify-content-center","pagination justify-content-end"]},{label:"setting.classes",attr:"class",type:"text"}]},{id:"spinner",label:"Spinner",icon:p.spinner,html:'<div class="text-center p-3"><div class="spinner-border text-primary" role="status"><span class="visually-hidden">Cargando...</span></div></div>',settings:[{label:"setting.variant",attr:"class",selector:'[role="status"]',type:"select",options:["spinner-border text-primary","spinner-border text-secondary","spinner-border text-success","spinner-border text-danger","spinner-border text-warning","spinner-border text-info","spinner-grow text-primary","spinner-grow text-secondary","spinner-grow text-success","spinner-grow text-danger"]},{label:"setting.classes",attr:"class",type:"text"}]},{id:"toast",label:"Toast",icon:p.toast,html:'<div class="toast show" role="alert"><div class="toast-header"><strong class="me-auto">Notificación</strong><small>Ahora</small><button type="button" class="btn-close" data-bs-dismiss="toast"></button></div><div class="toast-body">Este es un mensaje de notificación.</div></div>',settings:[{label:"setting.title",prop:"textContent",selector:".me-auto",type:"text"},{label:"setting.text",prop:"textContent",selector:".toast-body",type:"text"},{label:"setting.time",prop:"textContent",selector:"small",type:"text"},{label:"setting.classes",attr:"class",type:"text"}]}],forms:[{id:"form",label:"Form",icon:p.container,html:'<form class="p-4 border rounded"><div class="mb-3"><label class="form-label">Nombre</label><input type="text" class="form-control" name="nombre" placeholder="Tu nombre"></div><div class="mb-3"><label class="form-label">Email</label><input type="email" class="form-control" name="email" placeholder="tu@email.com"></div><button type="submit" class="btn btn-primary">Enviar</button></form>',settings:[{label:"setting.action",attr:"action",type:"text"},{label:"setting.method",attr:"method",type:"select",options:["","GET","POST"]},{label:"setting.buttonText",prop:"textContent",selector:"button",type:"text"},{label:"setting.id",attr:"id",type:"text"},{label:"setting.classes",attr:"class",type:"text"}]},{id:"input",label:"Input",icon:p.input,html:'<div class="mb-3"><label class="form-label">Campo</label><input type="text" class="form-control" name="campo"></div>',settings:[{label:"setting.label",prop:"textContent",selector:"label",type:"text"},{label:"setting.type",attr:"type",selector:"input",type:"select",options:["text","email","password","number","tel","url","date","time","datetime-local","month","week","color","hidden"]},{label:"setting.name",attr:"name",selector:"input",type:"text"},{label:"setting.placeholder",attr:"placeholder",selector:"input",type:"text"},{label:"setting.value",attr:"value",selector:"input",type:"text"},{label:"setting.required",attr:"required",selector:"input",type:"checkbox"},{label:"setting.readonly",attr:"readonly",selector:"input",type:"checkbox"},{label:"setting.disabled",attr:"disabled",selector:"input",type:"checkbox"}]},{id:"textarea",label:"Textarea",icon:p.textarea,html:'<div class="mb-3"><label class="form-label">Descripción</label><textarea class="form-control" rows="3" name="descripcion"></textarea></div>',settings:[{label:"setting.label",prop:"textContent",selector:"label",type:"text"},{label:"setting.name",attr:"name",selector:"textarea",type:"text"},{label:"setting.placeholder",attr:"placeholder",selector:"textarea",type:"text"},{label:"setting.rows",attr:"rows",selector:"textarea",type:"text"},{label:"setting.required",attr:"required",selector:"textarea",type:"checkbox"},{label:"setting.readonly",attr:"readonly",selector:"textarea",type:"checkbox"},{label:"setting.disabled",attr:"disabled",selector:"textarea",type:"checkbox"}]},{id:"select",label:"Select",icon:p.select,html:'<div class="mb-3"><label class="form-label">Selecciona</label><select class="form-select" name="seleccion"><option value="1">Opción 1</option><option value="2">Opción 2</option><option value="3">Opción 3</option></select></div>',settings:[{label:"setting.label",prop:"textContent",selector:"label",type:"text"},{label:"setting.name",attr:"name",selector:"select",type:"text"},{label:"setting.options",prop:"options",selector:"select",type:"options"},{label:"setting.required",attr:"required",selector:"select",type:"checkbox"},{label:"setting.disabled",attr:"disabled",selector:"select",type:"checkbox"}]},{id:"checkbox",label:"Checkbox",icon:p.input,html:'<div class="mb-3 form-check"><input type="checkbox" class="form-check-input" id="check1" name="check1"><label class="form-check-label" for="check1">Opción</label></div>',settings:[{label:"setting.name",attr:"name",selector:"input",type:"text"},{label:"setting.id",attr:"id",selector:"input",type:"text"},{label:"setting.text",prop:"textContent",selector:"label",type:"text"},{label:"setting.checked",attr:"checked",selector:"input",type:"checkbox"},{label:"setting.required",attr:"required",selector:"input",type:"checkbox"},{label:"setting.disabled",attr:"disabled",selector:"input",type:"checkbox"}]},{id:"radio",label:"Radio",icon:p.input,html:'<div class="mb-3"><div class="form-check"><input class="form-check-input" type="radio" name="radio1" id="radio1" value="1"><label class="form-check-label" for="radio1">Opción 1</label></div><div class="form-check"><input class="form-check-input" type="radio" name="radio1" id="radio2" value="2"><label class="form-check-label" for="radio2">Opción 2</label></div><div class="form-check"><input class="form-check-input" type="radio" name="radio1" id="radio3" value="3"><label class="form-check-label" for="radio3">Opción 3</label></div></div>',settings:[{label:"setting.name",attr:"name",selector:"input",type:"text",all:!0},{label:"setting.disabled",attr:"disabled",selector:"input",type:"checkbox",all:!0},{label:"setting.required",attr:"required",selector:"input",type:"checkbox"}]},{id:"file",label:"File",icon:p.input,html:'<div class="mb-3"><label class="form-label">Archivo</label><input type="file" class="form-control" name="archivo"></div>',settings:[{label:"setting.label",prop:"textContent",selector:"label",type:"text"},{label:"setting.name",attr:"name",selector:"input",type:"text"},{label:"setting.accept",attr:"accept",selector:"input",type:"text"},{label:"setting.multiple",attr:"multiple",selector:"input",type:"checkbox"},{label:"setting.required",attr:"required",selector:"input",type:"checkbox"},{label:"setting.disabled",attr:"disabled",selector:"input",type:"checkbox"}]},{id:"range",label:"Range",icon:p.input,html:'<div class="mb-3"><label class="form-label">Rango</label><input type="range" class="form-range" name="rango" min="0" max="100" step="1" value="50"></div>',settings:[{label:"setting.label",prop:"textContent",selector:"label",type:"text"},{label:"setting.name",attr:"name",selector:"input",type:"text"},{label:"setting.min",attr:"min",selector:"input",type:"text"},{label:"setting.max",attr:"max",selector:"input",type:"text"},{label:"setting.step",attr:"step",selector:"input",type:"text"},{label:"setting.value",attr:"value",selector:"input",type:"text"},{label:"setting.disabled",attr:"disabled",selector:"input",type:"checkbox"}]},{id:"switch",label:"Switch",icon:p.input,html:'<div class="mb-3 form-check form-switch"><input class="form-check-input" type="checkbox" role="switch" id="switch1" name="switch1"><label class="form-check-label" for="switch1">Activar</label></div>',settings:[{label:"setting.name",attr:"name",selector:"input",type:"text"},{label:"setting.id",attr:"id",selector:"input",type:"text"},{label:"setting.text",prop:"textContent",selector:"label",type:"text"},{label:"setting.checked",attr:"checked",selector:"input",type:"checkbox"},{label:"setting.required",attr:"required",selector:"input",type:"checkbox"},{label:"setting.disabled",attr:"disabled",selector:"input",type:"checkbox"}]}],sections:[{id:"navbar",label:"Navbar",icon:p.navbar,html:'<nav class="navbar navbar-expand-lg navbar-dark bg-dark"><div class="container"><a class="navbar-brand" href="#">Logo</a><ul class="navbar-nav ms-auto"><li class="nav-item"><a class="nav-link" href="#">Inicio</a></li><li class="nav-item"><a class="nav-link" href="#">Contacto</a></li></ul></div></nav>',settings:[{label:"setting.brand",prop:"textContent",selector:".navbar-brand",type:"text"},{label:"setting.url",attr:"href",selector:".navbar-brand",type:"text"},{label:"setting.classes",attr:"class",type:"text"}]},{id:"hero",label:"Hero",icon:p.hero,html:'<section class="py-5 bg-primary text-white text-center"><div class="container py-5"><h1 class="display-4">Bienvenido</h1><p class="lead">Descripción del sitio</p><a href="#" class="btn btn-light btn-lg">Comenzar</a></div></section>',settings:[{label:"setting.title",prop:"textContent",selector:"h1",type:"text"},{label:"setting.subtitle",prop:"textContent",selector:".lead",type:"text"},{label:"setting.buttonText",prop:"textContent",selector:".btn",type:"text"},{label:"setting.buttonUrl",attr:"href",selector:".btn",type:"text"},{label:"setting.classes",attr:"class",type:"text"}]},{id:"features",label:"Features",icon:p.features,html:'<section class="py-5"><div class="container"><h2 class="text-center mb-5">Características</h2><div class="row g-4"><div class="col-md-4 text-center"><h5>Rápido</h5><p>Descripción</p></div><div class="col-md-4 text-center"><h5>Seguro</h5><p>Descripción</p></div><div class="col-md-4 text-center"><h5>Simple</h5><p>Descripción</p></div></div></div></section>',settings:[{label:"setting.title",prop:"textContent",selector:"h2",type:"text"},{label:"setting.classes",attr:"class",type:"text"},{label:"setting.id",attr:"id",type:"text"}]},{id:"footer",label:"Footer",icon:p.footer,html:'<footer class="py-4 bg-dark text-white text-center"><div class="container"><p class="mb-0">&copy; 2024 Mi Sitio</p></div></footer>',settings:[{label:"setting.footerText",prop:"innerHTML",selector:"p",type:"text"},{label:"setting.classes",attr:"class",type:"text"},{label:"setting.id",attr:"id",type:"text"}]}]};function m(e,t){return"html"===t?function(e){if(!e)return"";let t=a(e);return t=t.replace(/(&lt;!--[\s\S]*?--&gt;)/g,'<span class="tok-comment">$1</span>'),t=t.replace(/(&lt;\/?)([\w-]+)((?:\s+[\s\S]*?)?)(\/?&gt;)/g,(e,t,s,o,a)=>{let n=o.replace(/([\w-:@]+)(=)("(?:[^"]*?)"|'(?:[^']*?)'|&quot;(?:.*?)&quot;|&#39;(?:.*?)&#39;)/g,(e,t,s,o)=>'<span class="tok-attr">'+t+'</span><span class="tok-punct">'+s+'</span><span class="tok-str">'+o+"</span>");return n=n.replace(/(?<=\s)([\w-:@]+)(?=\s|$)(?![^<]*<\/span>)/g,'<span class="tok-attr">$1</span>'),`<span class="tok-punct">${t}</span><span class="tok-tag">${s}</span>${n}<span class="tok-punct">${a}</span>`}),t}(e):"css"===t?function(e){if(!e)return"";let t=a(e);return t=t.replace(/(\/\*[\s\S]*?\*\/)/g,'<span class="tok-comment">$1</span>'),t=t.replace(/(@[\w-]+)/g,'<span class="tok-kw">$1</span>'),t=t.replace(/^([^{}\/\n][^{}\n]*?)(\{)/gm,(e,t,s)=>`<span class="tok-selector">${t}</span><span class="tok-punct">${s}</span>`),t=t.replace(/([\w-]+)(\s*:\s*)([^;{}]+)(;?)/g,(e,t,s,o,a)=>{let n=o.replace(/(-?\d+\.?\d*)(px|em|rem|%|vh|vw|s|ms|deg)/g,'<span class="tok-num">$1</span><span class="tok-unit">$2</span>');return n=n.replace(/(#[0-9a-fA-F]{3,8})/g,'<span class="tok-num">$1</span>'),`<span class="tok-prop">${t}</span><span class="tok-punct">${s}</span>${n}<span class="tok-punct">${a}</span>`}),t}(e):"js"===t?function(e){if(!e)return"";let t=a(e);const s=[];let o=0;return t=t.replace(/(`[\s\S]*?`)/g,e=>{const t=`__P${o++}__`;return s.push({p:t,v:`<span class="tok-str">${e}</span>`}),t}),t=t.replace(/(&quot;[^&]*?&quot;)/g,e=>{const t=`__P${o++}__`;return s.push({p:t,v:`<span class="tok-str">${e}</span>`}),t}),t=t.replace(/(&#39;[^&]*?&#39;)/g,e=>{const t=`__P${o++}__`;return s.push({p:t,v:`<span class="tok-str">${e}</span>`}),t}),t=t.replace(/(\/\/.*$)/gm,e=>{const t=`__P${o++}__`;return s.push({p:t,v:`<span class="tok-comment">${e}</span>`}),t}),t=t.replace(new RegExp(`\\b(${["const","let","var","function","return","if","else","for","while","class","new","this","async","await","import","export","from","of","in"].join("|")})\\b`,"g"),'<span class="tok-kw">$1</span>'),t=t.replace(/\b(true|false|null|undefined)\b/g,'<span class="tok-bool">$1</span>'),t=t.replace(/\b(\d+\.?\d*)\b/g,'<span class="tok-num">$1</span>'),t=t.replace(/\b([a-zA-Z_$][\w$]*)\s*(?=\()/g,'<span class="tok-fn">$1</span>'),s.forEach(({p:e,v:s})=>t=t.replace(e,s)),t}(e):a(e)}class v{constructor(e,s={}){"string"==typeof e||e instanceof Element?(this.container="string"==typeof e?t(e):e,this.config={...this.getDefaultConfig(),...s}):(this.container=document.body,this.config={...this.getDefaultConfig(),...e});const o="string"==typeof e||e instanceof Element?s:e;this._themeFromConfig=o&&void 0!==o.theme,this.blocks={...g,...this.config.customBlocks||{}},this.config.blocks=this.blocks,this.selectedElement=null,this.clipboard=null,this.currentLang="html",this.code={html:"",css:"",js:""},this.history=[],this.historyIndex=-1,this.maxHistory=50,this._foldState={html:new Set,css:new Set,js:new Set},this._foldRegions={html:[],css:[],js:[]},this._displayCode={html:"",css:"",js:""},this._displayToRealMap={html:[],css:[],js:[]},i=this.config.lang||"en",this._init()}async _init(){await this.loadBlocks(),await this._loadStylesDef(),this.injectCSS(),this.render(),this._applyHighlightTheme(),this.cacheElements(),this.bindEvents(),this.initFrame(),this.loadFromStorage()}async loadBlocks(){const e=this.config.blocksPath;try{const t=await fetch(e+"_index.json");if(!t.ok)throw new Error("No index");const s=await t.json(),o=[];for(const e of s.categories)for(const t of e.blocks)o.push({catId:e.id,blockId:t});const a=await Promise.allSettled(o.map(({catId:t,blockId:s})=>fetch(`${e}${t}/${s}.json`).then(e=>e.json()))),n={};let l=0;for(const e of s.categories){n[e.id]=[];for(const t of e.blocks){const t=a[l++];if("fulfilled"===t.status){const s=t.value;n[e.id].push({id:s.id,label:s.label,icon:p[s.icon]||s.icon,html:s.html,css:s.css||"",settings:s.settings||[]})}}}this.blocks={...n,...this.config.customBlocks||{}}}catch(t){console.warn("ShouEditor: Could not load blocks from",e,"- using defaults"),this.blocks={...g,...this.config.customBlocks||{}}}this.config.blocks=this.blocks}async _loadStylesDef(){this.stylesDef=u;const e=this.config.stylesPath||"styles/";try{const[t,s,o]=await Promise.allSettled([fetch(e+"styles.json").then(e=>e.ok?e.json():Promise.reject()),fetch(e+"attributes.json").then(e=>e.ok?e.json():Promise.reject()),fetch(e+"highlight.json").then(e=>e.ok?e.json():Promise.reject())]);if("fulfilled"===t.status&&(this.stylesDef=t.value),"fulfilled"===s.status){const e=s.value;e.boolAttrs&&e.boolAttrs.forEach(e=>h.add(e)),e.common&&(b._common=e.common),e.tags&&Object.assign(b,e.tags)}"fulfilled"===o.status&&o.value.tokens&&(this._highlightTheme=o.value.tokens)}catch(e){}}_applyHighlightTheme(){const e=this._highlightTheme;if(!e)return;const t=this.container||document.documentElement;for(const[s,o]of Object.entries(e))t.style.setProperty(`--tok-${s}`,o)}getDefaultConfig(){return{theme:"dark",width:"100%",height:"100vh",defaultView:"visual",defaultDevice:"desktop",storagePrefix:"shou-editor-",bootstrapCss:"https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css",blocksPath:"blocks/",lang:"en",blocks:g,saveFormat:"html",saveTarget:"local",saveEndpoint:null,saveFilename:"proyecto",onSaveSuccess:null,onSaveError:null}}injectCSS(){if(!t("#jse-styles")){const e=document.createElement("style");e.id="jse-styles",e.textContent='\n.jse-editor{display:flex;flex-direction:column;font-family:system-ui,sans-serif;font-size:14px;background:var(--jse-bg);color:var(--jse-text);overflow:hidden;isolation:isolate}\n.jse-editor.theme-dark{--jse-bg:#1e1e1e;--jse-bg2:#252526;--jse-bg3:#323233;--jse-text:#d4d4d4;--jse-text2:#858585;--jse-border:#3c3c3c;--jse-accent:#007acc;--jse-hover:#2a2d2e}\n.jse-editor.theme-light{--jse-bg:#fff;--jse-bg2:#f3f3f3;--jse-bg3:#f8f8f8;--jse-text:#1e1e1e;--jse-text2:#6e6e6e;--jse-border:#e0e0e0;--jse-accent:#007acc;--jse-hover:#e8e8e8}\n.jse-toolbar{display:flex;align-items:center;justify-content:space-between;padding:8px 16px;background:var(--jse-bg3);border-bottom:1px solid var(--jse-border);gap:16px}\n.jse-toolbar-left,.jse-toolbar-center,.jse-toolbar-right{display:flex;align-items:center;gap:8px}\n.jse-logo{font-weight:700;color:var(--jse-accent);margin-right:12px}\n.jse-btn{padding:6px 10px;border:none;border-radius:6px;background:var(--jse-bg2);color:var(--jse-text);cursor:pointer;transition:background .15s;display:inline-flex;align-items:center;justify-content:center}\n.jse-btn:hover{background:var(--jse-hover)}\n.jse-btn svg{width:16px;height:16px;fill:currentColor}\n.jse-device-switcher,.jse-view-switcher{display:flex;background:var(--jse-bg2);border-radius:8px;padding:3px;gap:2px}\n.jse-device-btn,.jse-view-btn{padding:6px 10px;border:none;border-radius:6px;background:transparent;color:var(--jse-text2);cursor:pointer;transition:all .15s;display:inline-flex;align-items:center;justify-content:center}\n.jse-device-btn svg{width:16px;height:16px;fill:currentColor}\n.jse-device-btn:hover,.jse-view-btn:hover{color:var(--jse-text)}\n.jse-device-btn.active,.jse-view-btn.active{background:var(--jse-accent);color:#fff}\n.jse-main{display:flex;flex:1;overflow:hidden}\n.jse-panel{width:260px;min-width:200px;display:flex;flex-direction:column;background:var(--jse-bg2);border-color:var(--jse-border);overflow:hidden}\n.jse-panel-left{border-right:1px solid var(--jse-border)}\n.jse-panel-right{border-left:1px solid var(--jse-border)}\n.jse-panel-tabs{display:flex;background:var(--jse-bg3);border-bottom:1px solid var(--jse-border)}\n.jse-panel-tab{flex:1;padding:10px;border:none;background:transparent;color:var(--jse-text2);font-size:12px;font-weight:600;text-transform:uppercase;cursor:pointer;border-bottom:2px solid transparent}\n.jse-panel-tab:hover{color:var(--jse-text)}\n.jse-panel-tab.active{color:var(--jse-accent);border-bottom-color:var(--jse-accent)}\n.jse-panel-body{flex:1;overflow-y:auto;padding:12px;display:none;min-height:0}\n.jse-panel-body.active{display:block}\n.jse-category{margin-bottom:12px}\n.jse-cat-header{display:flex;justify-content:space-between;align-items:center;padding:8px;font-size:11px;font-weight:700;text-transform:uppercase;color:var(--jse-text2);cursor:pointer;border-bottom:1px solid var(--jse-border)}\n.jse-cat-header:hover{color:var(--jse-text)}\n.jse-chevron{display:inline-flex;transition:transform .2s}\n.jse-chevron svg{width:12px;height:12px;fill:currentColor}\n.jse-category:not(.open) .jse-chevron{transform:rotate(-90deg)}\n.jse-category:not(.open) .jse-cat-blocks{display:none}\n.jse-cat-blocks{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;padding:8px 0}\n.jse-block{display:flex;flex-direction:column;align-items:center;gap:4px;padding:12px 8px;background:var(--jse-bg);border:1px solid var(--jse-border);border-radius:8px;cursor:grab;transition:all .15s;font-size:11px}\n.jse-block:hover{border-color:var(--jse-accent);background:var(--jse-hover)}\n.jse-block.dragging{opacity:.5}\n.jse-block-icon{display:flex;align-items:center;justify-content:center;width:22px;height:22px}\n.jse-block-icon svg{width:20px;height:20px;fill:currentColor}\n.jse-empty{padding:20px;text-align:center;color:var(--jse-text2)}\n.jse-canvas-wrap{flex:1;display:flex;flex-direction:column;overflow:hidden;min-width:400px}\n.jse-visual-canvas,.jse-code-canvas{display:none;flex:1;flex-direction:column;overflow:hidden}\n.jse-visual-canvas.active,.jse-code-canvas.active{display:flex}\n.jse-visual-canvas{align-items:center;justify-content:center;padding:20px;background:#141414;background-image:linear-gradient(45deg,#1a1a1a 25%,transparent 25%),linear-gradient(-45deg,#1a1a1a 25%,transparent 25%),linear-gradient(45deg,transparent 75%,#1a1a1a 75%),linear-gradient(-45deg,transparent 75%,#1a1a1a 75%);background-size:20px 20px;position:relative}\n.jse-canvas-breadcrumb{display:none;align-items:center;gap:2px;padding:4px 10px;background:var(--jse-bg2);border-top:1px solid var(--jse-border);font-size:12px;font-family:monospace;overflow-x:auto;white-space:nowrap;flex-shrink:0;width:100%}\n.jse-canvas-breadcrumb.visible{display:flex}\n.jse-canvas-breadcrumb .jse-breadcrumb{cursor:pointer;padding:2px 6px;border-radius:4px;color:var(--jse-text2);transition:background .15s,color .15s}\n.jse-canvas-breadcrumb .jse-breadcrumb:hover{background:var(--jse-hover);color:var(--jse-text)}\n.jse-canvas-breadcrumb .jse-breadcrumb.active{background:var(--jse-accent);color:#fff;font-weight:600}\n.jse-canvas-breadcrumb .jse-bc-sep{color:var(--jse-text2);opacity:0.5;font-size:10px}\n.jse-frame{width:100%;height:100%;max-width:1200px;background:#fff;border:none;border-radius:4px;box-shadow:0 4px 20px rgba(0,0,0,.2);transition:max-width .3s}\n.jse-visual-canvas[data-device="tablet"] .jse-frame{max-width:768px}\n.jse-visual-canvas[data-device="mobile"] .jse-frame{max-width:375px}\n.jse-code-tabs{display:flex;background:var(--jse-bg3);border-bottom:1px solid var(--jse-border);padding:0 8px}\n.jse-code-tab{padding:10px 16px;border:none;background:transparent;color:var(--jse-text2);font-size:13px;cursor:pointer;border-bottom:2px solid transparent}\n.jse-code-tab:hover{color:var(--jse-text)}\n.jse-code-tab.active{color:var(--jse-accent);border-bottom-color:var(--jse-accent)}\n.jse-code-editors{flex:1;position:relative}\n.jse-code-editor{display:none;position:absolute;inset:0}\n.jse-code-editor.active{display:flex}\n.jse-lines{min-width:45px;padding:12px 8px;background:var(--jse-bg);border-right:1px solid var(--jse-border);font:13px/1.6 monospace;color:var(--jse-text2);text-align:right;user-select:none;overflow:hidden}\n.jse-lines>span{display:block}\n.jse-fold{cursor:pointer;color:var(--jse-accent);transition:color .15s;font-size:10px;margin-right:2px}\n.jse-fold:hover{color:var(--jse-text)}\n.jse-textarea,.jse-highlight{position:absolute;top:0;left:45px;right:0;bottom:0;padding:12px;font:13px/1.6 monospace;tab-size:2;white-space:pre-wrap;word-wrap:break-word;overflow:auto}\n.jse-textarea{background:transparent;color:transparent;caret-color:var(--jse-text);border:none;outline:none;resize:none;z-index:2}\n.jse-highlight{background:var(--jse-bg);color:var(--jse-text);z-index:1;pointer-events:none;margin:0}\n.jse-highlight code{display:block;font:inherit}\n.jse-code-drop-bar{position:absolute;left:45px;right:0;height:2px;background:var(--jse-accent);z-index:10;pointer-events:none;box-shadow:0 0 6px var(--jse-accent)}\n.tok-comment{color:var(--tok-comment,#6a9955);font-style:italic}.tok-tag{color:var(--tok-tag,#569cd6)}.tok-attr{color:var(--tok-attr,#e5c07b)}.tok-str{color:var(--tok-str,#ce9178)}.tok-kw{color:var(--tok-kw,#c586c0)}.tok-num{color:var(--tok-num,#b5cea8)}.tok-bool{color:var(--tok-bool,#569cd6)}.tok-fn{color:var(--tok-fn,#dcdcaa)}.tok-prop{color:var(--tok-prop,#9cdcfe)}.tok-punct{color:var(--tok-punct,#808080)}.tok-unit{color:var(--tok-unit,#b5cea8)}.tok-selector{color:var(--tok-selector,#d7ba7d)}\n.jse-selected-info{padding:8px 12px;background:var(--jse-bg);border-radius:8px;margin-bottom:12px;font-size:12px;display:flex;flex-wrap:wrap;align-items:center;gap:2px}\n.jse-no-sel{color:var(--jse-text2)}\n.jse-breadcrumb{cursor:pointer;padding:2px 6px;border-radius:4px;color:var(--jse-text2);transition:background .15s,color .15s}\n.jse-breadcrumb:hover{background:var(--jse-hover);color:var(--jse-text)}\n.jse-breadcrumb.active{background:var(--jse-accent);color:#fff;font-weight:600}\n.jse-bc-sep{color:var(--jse-text2);opacity:0.5;font-size:10px}\n.jse-style-section{margin-bottom:8px}\n.jse-section-header{display:flex;justify-content:space-between;align-items:center;padding:8px;font-size:11px;font-weight:600;color:var(--jse-text2);cursor:pointer;border-bottom:1px solid var(--jse-border)}\n.jse-section-header:hover{color:var(--jse-text)}\n.jse-style-section:not(.open) .jse-section-body{display:none}\n.jse-section-body{padding:12px 0}\n.jse-row{display:flex;align-items:center;gap:8px;margin-bottom:8px}\n.jse-row label{flex:0 0 70px;font-size:12px;color:var(--jse-text2)}\n.jse-row input,.jse-row select{flex:1;padding:6px 8px;border:1px solid var(--jse-border);border-radius:4px;background:var(--jse-bg);color:var(--jse-text);font-size:12px}\n.jse-row input:focus,.jse-row select:focus{outline:none;border-color:var(--jse-accent)}\n.jse-row input[type="color"]{width:32px;height:32px;padding:2px;cursor:pointer}\n.jse-row input[type="checkbox"]{flex:0 0 auto;width:0;height:0;min-width:0;opacity:0;position:absolute;pointer-events:none;overflow:visible}\n.jse-toggle{flex:0 0 28px;width:28px;height:16px;min-width:28px;border-radius:8px;background:var(--jse-border);position:relative;cursor:pointer;transition:background .2s;overflow:visible}\n.jse-toggle::after{content:\'\';position:absolute;top:2px;left:2px;width:12px;height:12px;border-radius:50%;background:var(--jse-text2);transition:transform .2s,background .2s}\ninput[type="checkbox"]:checked+.jse-toggle{background:var(--jse-accent)}\ninput[type="checkbox"]:checked+.jse-toggle::after{transform:translateX(12px);background:#fff}\n.jse-setting{display:flex;align-items:center;justify-content:space-between;padding:8px 0}\n.jse-setting label{font-size:13px}\n.jse-setting select{padding:6px 8px;border:1px solid var(--jse-border);border-radius:4px;background:var(--jse-bg);color:var(--jse-text)}\n.jse-row input,.jse-row select{flex:1;min-width:0;max-width:100%;overflow:hidden;text-overflow:ellipsis}\n.jse-panel-right .jse-section-body{overflow-x:hidden}\n.jse-layer{display:flex;align-items:center;gap:6px;padding:6px 8px;border-bottom:1px solid var(--jse-border);cursor:pointer;font-size:12px;font-family:monospace;flex-shrink:0}\n.jse-layer:hover{background:var(--jse-hover)}\n.jse-layer-dragging{opacity:0.4}\n.jse-layer-drop-before{border-top:2px solid var(--jse-accent)!important}\n.jse-layer-drop-after{border-bottom:2px solid var(--jse-accent)!important}\n.jse-layer-drop-inside{background:rgba(0,122,204,0.15)!important}\n.jse-layer.selected{background:var(--jse-accent);color:#fff}\n.jse-layer-tag{color:var(--jse-accent);font-weight:600}\n.jse-layer.selected .jse-layer-tag{color:#fff}\n.jse-layer-indent{display:inline-block}\n.jse-toolbar-toggle{display:flex;gap:4px;margin-left:8px}\n.jse-toggle-btn{padding:4px 8px;border:1px solid var(--jse-border);border-radius:4px;background:var(--jse-bg);color:var(--jse-text2);cursor:pointer;font-size:11px;transition:all .15s;display:inline-flex;align-items:center;gap:4px}\n.jse-toggle-btn svg{width:14px;height:14px;fill:currentColor}\n.jse-toggle-btn:hover{border-color:var(--jse-accent);color:var(--jse-text)}\n.jse-toggle-btn.active{background:var(--jse-accent);color:#fff;border-color:var(--jse-accent)}\n.jse-editor *::-webkit-scrollbar{width:8px;height:8px}\n.jse-editor *::-webkit-scrollbar-track{background:var(--jse-bg)}\n.jse-editor *::-webkit-scrollbar-thumb{background:var(--jse-bg3);border-radius:4px}\n.jse-editor *::-webkit-scrollbar-thumb:hover{background:var(--jse-text2)}\n.jse-editor *::-webkit-scrollbar-corner{background:var(--jse-bg)}\n.jse-editor{scrollbar-color:var(--jse-bg3) var(--jse-bg)}\n.jse-editor *{scrollbar-color:var(--jse-bg3) var(--jse-bg);scrollbar-width:thin}\n@media(max-width:992px){.jse-panel,.jse-resize-handle{display:none}.jse-canvas-wrap{min-width:0}}\n.jse-image-modal{position:fixed;inset:0;z-index:10000;background:rgba(0,0,0,0.8);display:flex;align-items:center;justify-content:center;backdrop-filter:blur(4px)}\n.jse-image-modal-content{width:90vw;height:90vh;border-radius:8px;overflow:hidden}\n/* Fullscreen mode */\n.jse-editor.jse-fullscreen{position:fixed!important;inset:0!important;width:100vw!important;height:100vh!important;border-radius:0!important;box-shadow:none!important}\n/* Resize handles */\n.jse-resize-handle{width:5px;cursor:col-resize;background:transparent;flex-shrink:0;position:relative;z-index:10;transition:background .15s}\n.jse-resize-handle:hover,.jse-resize-handle.dragging{background:var(--jse-accent)}\n.jse-resize-handle::after{content:\'\';position:absolute;inset:-2px -4px;z-index:1}\n    ',document.head.appendChild(e)}}render(){this.container.innerHTML=function(e){const t=Object.entries(e.blocks).map(([e,t])=>`\n      <div class="jse-category open" data-cat="${e}">\n        <div class="jse-cat-header"><span>${e.charAt(0).toUpperCase()+e.slice(1)}</span><span class="jse-chevron">${p.chevron}</span></div>\n        <div class="jse-cat-blocks">\n          ${t.map(e=>`<div class="jse-block" data-block="${e.id}" draggable="true"><span class="jse-block-icon">${e.icon}</span><span>${e.label}</span></div>`).join("")}\n        </div>\n      </div>\n    `).join("");return`\n<div class="jse-editor theme-${e.theme}" style="width:${e.width};height:${e.height}">\n  \x3c!-- TOOLBAR --\x3e\n  <header class="jse-toolbar">\n    <div class="jse-toolbar-left">\n      <span class="jse-logo">Shou Editor</span>\n      <button type="button" class="jse-btn" data-action="new" title="${c("btn.new")}">${p.fileNew}</button>\n      <button type="button" class="jse-btn" data-action="open" title="${c("btn.open")}">${p.folderOpen}</button>\n      <button type="button" class="jse-btn" data-action="save" title="${c("btn.save")}">${p.save}</button>\n    </div>\n    <div class="jse-toolbar-center">\n      <div class="jse-device-switcher">\n        <button type="button" class="jse-device-btn active" data-device="desktop" title="Desktop">${p.desktop}</button>\n        <button type="button" class="jse-device-btn" data-device="tablet" title="Tablet">${p.tablet}</button>\n        <button type="button" class="jse-device-btn" data-device="mobile" title="Mobile">${p.mobile}</button>\n      </div>\n      <div class="jse-view-switcher">\n        <button type="button" class="jse-view-btn ${"visual"===e.defaultView?"active":""}" data-view="visual">Visual</button>\n        <button type="button" class="jse-view-btn ${"code"===e.defaultView?"active":""}" data-view="code">${c("view.code")}</button>\n      </div>\n      <div class="jse-toolbar-toggle">\n        <button type="button" class="jse-toggle-btn" data-toggle="outlines" title="${c("btn.toggleOutlines")}">${p.outlines} Outlines</button>\n      </div>\n    </div>\n    <div class="jse-toolbar-right">\n      <button type="button" class="jse-btn" data-action="preview" title="Preview">${p.preview}</button>\n      <button type="button" class="jse-btn" data-action="export" title="${c("btn.export")}">${p.download}</button>\n      <button type="button" class="jse-btn" data-action="theme" title="${c("btn.theme")}">${p.theme}</button>\n      <button type="button" class="jse-btn jse-fullscreen-btn" data-action="fullscreen" title="${c("btn.fullscreen")}">${p.fullscreen}</button>\n    </div>\n  </header>\n\n  \x3c!-- MAIN LAYOUT --\x3e\n  <main class="jse-main">\n    \x3c!-- LEFT PANEL: Blocks --\x3e\n    <aside class="jse-panel jse-panel-left">\n      <div class="jse-panel-tabs">\n        <button type="button" class="jse-panel-tab active" data-panel="blocks">${c("panel.blocks")}</button>\n        <button type="button" class="jse-panel-tab" data-panel="layers">${c("panel.layers")}</button>\n      </div>\n      <div class="jse-panel-body active" id="jse-blocks">${t}</div>\n      <div class="jse-panel-body" id="jse-layers"><div class="jse-empty">${c("empty.dragElements")}</div></div>\n    </aside>\n    <div class="jse-resize-handle jse-resize-left" title="Resize"></div>\n\n    \x3c!-- CANVAS --\x3e\n    <section class="jse-canvas-wrap">\n      <div class="jse-visual-canvas ${"visual"===e.defaultView?"active":""}" data-device="${e.defaultDevice}">\n        <iframe class="jse-frame"></iframe>\n        <div class="jse-canvas-breadcrumb"></div>\n      </div>\n      <div class="jse-code-canvas ${"code"===e.defaultView?"active":""}">\n        <div class="jse-code-tabs">\n          <button type="button" class="jse-code-tab active" data-lang="html">HTML</button>\n          <button type="button" class="jse-code-tab" data-lang="css">CSS</button>\n          <button type="button" class="jse-code-tab" data-lang="js">JS</button>\n        </div>\n        <div class="jse-code-editors">\n          <div class="jse-code-editor active" data-lang="html">\n            <div class="jse-lines"></div>\n            <textarea class="jse-textarea" spellcheck="false"></textarea>\n            <pre class="jse-highlight"><code></code></pre>\n          </div>\n          <div class="jse-code-editor" data-lang="css">\n            <div class="jse-lines"></div>\n            <textarea class="jse-textarea" spellcheck="false"></textarea>\n            <pre class="jse-highlight"><code></code></pre>\n          </div>\n          <div class="jse-code-editor" data-lang="js">\n            <div class="jse-lines"></div>\n            <textarea class="jse-textarea" spellcheck="false"></textarea>\n            <pre class="jse-highlight"><code></code></pre>\n          </div>\n        </div>\n        <div class="jse-canvas-breadcrumb jse-code-breadcrumb"></div>\n      </div>\n    </section>\n    <div class="jse-resize-handle jse-resize-right" title="Resize"></div>\n\n    \x3c!-- RIGHT PANEL: Styles --\x3e\n    <aside class="jse-panel jse-panel-right">\n      <div class="jse-panel-tabs">\n        <button type="button" class="jse-panel-tab active" data-panel="styles">${c("panel.styles")}</button>\n        <button type="button" class="jse-panel-tab" data-panel="settings">${c("panel.settings")}</button>\n      </div>\n      <div class="jse-panel-body active" id="jse-styles">\n        <div class="jse-selected-info"><span class="jse-no-sel">${c("empty.selectElement")}</span></div>\n        <div class="jse-styles-editor"></div>\n      </div>\n      <div class="jse-panel-body" id="jse-settings">\n        <div class="jse-selected-info" id="jse-attrs-info"><span class="jse-no-sel">${c("empty.selectElement")}</span></div>\n        <div id="jse-attrs-editor"></div>\n      </div>\n    </aside>\n  </main>\n</div>\n<input type="file" class="jse-file-input" accept=".html,.htm" style="display:none">\n`}(this.config),this.root=t(".jse-editor",this.container)}cacheElements(){this.frame=t(".jse-frame",this.root),this.visualCanvas=t(".jse-visual-canvas",this.root),this.canvasBreadcrumb=t(".jse-canvas-breadcrumb:not(.jse-code-breadcrumb)",this.root),this.codeBreadcrumb=t(".jse-code-breadcrumb",this.root),this.codeCanvas=t(".jse-code-canvas",this.root),this.blocksPanel=t("#jse-blocks",this.root),this.layersPanel=t("#jse-layers",this.root),this.stylesPanel=t("#jse-styles",this.root),this.selectedInfo=t(".jse-selected-info",this.root),this.attrsPanel=t("#jse-attrs-editor",this.root),this.attrsInfo=t("#jse-attrs-info",this.root),this.fileInput=t(".jse-file-input",this.container),this.codeEditors={},["html","css","js"].forEach(e=>{const s=t(`.jse-code-editor[data-lang="${e}"]`,this.root);s&&(this.codeEditors[e]={wrapper:s,textarea:t(".jse-textarea",s),highlight:t(".jse-highlight code",s),lines:t(".jse-lines",s)})})}bindEvents(){const e=this.root;e.addEventListener("click",e=>{e.target.closest("button")&&e.preventDefault()}),document.addEventListener("keydown",e=>{"Escape"===e.key&&this.root.classList.contains("jse-fullscreen")&&this.toggleFullscreen()}),o(e,"click",".jse-btn",(e,t)=>{const s=t.dataset.action;"new"===s&&this.newProject(),"open"===s&&this.fileInput?.click(),"save"===s&&this.save(),"preview"===s&&this.preview(),"export"===s&&this.exportHtml(),"theme"===s&&this.toggleTheme(),"fullscreen"===s&&this.toggleFullscreen()}),o(e,"click",".jse-device-btn",(t,o)=>{s(".jse-device-btn",e).forEach(e=>e.classList.remove("active")),o.classList.add("active"),this.visualCanvas&&(this.visualCanvas.dataset.device=o.dataset.device)}),o(e,"click",".jse-view-btn",(t,o)=>{s(".jse-view-btn",e).forEach(e=>e.classList.remove("active")),o.classList.add("active");const a=o.dataset.view;this.visualCanvas?.classList.toggle("active","visual"===a),this.codeCanvas?.classList.toggle("active","code"===a),"code"===a&&this.syncToCode(),"visual"===a&&this.syncFromCode()}),o(e,"click",".jse-panel-tab",(e,o)=>{const a=o.closest(".jse-panel");s(".jse-panel-tab",a).forEach(e=>e.classList.remove("active")),s(".jse-panel-body",a).forEach(e=>e.classList.remove("active")),o.classList.add("active");const n=t(`#jse-${o.dataset.panel}`,a);n&&n.classList.add("active")}),o(e,"click",".jse-cat-header",(e,t)=>{t.closest(".jse-category")?.classList.toggle("open")}),o(e,"click",".jse-section-header",(e,t)=>{t.closest(".jse-style-section")?.classList.toggle("open")}),this._initPanelResize(),o(this.blocksPanel,"dragstart",".jse-block",(e,t)=>{e.dataTransfer.setData("text/plain",t.dataset.block),e.dataTransfer.effectAllowed="copy",t.classList.add("dragging")}),o(this.blocksPanel,"dragend",".jse-block",(e,t)=>{t.classList.remove("dragging")}),o(this.blocksPanel,"click",".jse-block",(e,t)=>{this.insertBlock(t.dataset.block)}),o(e,"click",".jse-toggle-btn",(e,t)=>{t.classList.toggle("active");"outlines"===t.dataset.toggle&&this.toggleOutlines(t.classList.contains("active"))}),o(e,"click",".jse-code-tab",(t,o)=>{s(".jse-code-tab",e).forEach(e=>e.classList.remove("active")),o.classList.add("active"),this.setCodeLang(o.dataset.lang)}),Object.entries(this.codeEditors).forEach(([e,t])=>{if(!t.textarea)return;o(t.textarea,"input",()=>{this._foldState[e].size>0?this.code[e]=this._displayToRealCode(e,t.textarea.value):this.code[e]=t.textarea.value,this.updateCodeEditor(e),this.saveToStorage(),clearTimeout(this._historyTimer),this._historyTimer=setTimeout(()=>this.pushHistory(),800)}),o(t.textarea,"scroll",()=>{t.highlight&&(t.highlight.parentElement.scrollTop=t.textarea.scrollTop),t.lines&&(t.lines.scrollTop=t.textarea.scrollTop)}),o(t.textarea,"keydown",t=>this.handleCodeKeydown(t,e)),t.lines&&o(t.lines,"click",".jse-fold",(s,o)=>{s.stopPropagation();const a=parseInt(o.dataset.foldLine);isNaN(a)||(this._toggleFold(e,a),t.textarea&&(t.textarea.value=this._displayCode[e]))});let s=null;const a=e=>{const s=t.textarea,o=s.getBoundingClientRect(),a=parseFloat(getComputedStyle(s).lineHeight)||20.8,n=e.clientY-o.top+s.scrollTop-12;return Math.max(0,Math.round(n/a))},n=()=>{s&&(s.style.display="none")};t.textarea.addEventListener("dragover",e=>{e.dataTransfer.types.includes("text/plain")&&(e.preventDefault(),e.dataTransfer.dropEffect="copy",(e=>{const o=t.textarea,n=t.wrapper;s||(s=document.createElement("div"),s.className="jse-code-drop-bar",n.appendChild(s));const l=parseFloat(getComputedStyle(o).lineHeight)||20.8,i=12+a(e)*l-o.scrollTop;s.style.top=i+"px",s.style.display=""})(e))}),t.textarea.addEventListener("dragleave",e=>{t.wrapper.contains(e.relatedTarget)||n()}),t.textarea.addEventListener("drop",s=>{n();const o=s.dataTransfer.getData("text/plain"),l=o?this.getBlockById(o):null;if(!l)return;s.preventDefault();let i="";if("html"===e?i=l.html:"css"===e&&l.css&&(i=l.css),!i)return;const r=t.textarea,c=((e,t)=>{const s=e.value.split("\n");let o=0;for(let e=0;e<Math.min(t,s.length);e++)o+=s[e].length+1;return o})(r,a(s)),d=r.value.substring(0,c),p=r.value.substring(c),h=d.length&&!d.endsWith("\n")?"\n":"";r.value=d+h+i+"\n"+p,this.code[e]=r.value,this.updateCodeEditor(e),this.saveToStorage(),this.pushHistory();const b=c+h.length+i.length+1;r.setSelectionRange(b,b),r.focus()})}),o(this.stylesPanel,"input","[data-style]",(e,t)=>{this.selectedElement&&(this.selectedElement.style[t.dataset.style]=t.value,this.syncToCode())}),o(this.stylesPanel,"change","select[data-style]",(e,t)=>{this.selectedElement&&(this.selectedElement.style[t.dataset.style]=t.value,this.syncToCode())}),o(this.fileInput,"change",e=>{const t=e.target.files?.[0];if(t){const s=new FileReader;s.onload=e=>this.importHtml(e.target.result),s.readAsText(t),e.target.value=""}}),o(t("#jse-settings",e),"input","input[data-attr]",(e,t)=>{if(!this.selectedElement)return;const s=t.dataset.attr;"checkbox"===t.type?t.checked?this.selectedElement.setAttribute(s,""):this.selectedElement.removeAttribute(s):t.value?this.selectedElement.setAttribute(s,t.value):this.selectedElement.removeAttribute(s),this.syncToCode()});const a=t("#jse-settings",e),n=e=>{if(!this.selectedElement)return;const t=this._findBlockRoot(this.selectedElement);if(!t)return;const s=t.getAttribute("data-jse-block"),o=s?this.getBlockById(s):null;if(!o||!o.settings)return;const a=parseInt(e.dataset.sidx,10),n=o.settings[a];if(!n)return;const l=n.selector?t.querySelector(n.selector):t;if(l){if("checkbox"===n.type)n.attr&&(e.checked?(l.setAttribute(n.attr,""),n.all&&t.querySelectorAll(n.selector).forEach(e=>e.setAttribute(n.attr,""))):(l.removeAttribute(n.attr),n.all&&t.querySelectorAll(n.selector).forEach(e=>e.removeAttribute(n.attr))));else if("select"===n.type){const t=e.value;if(n.attr)l.setAttribute(n.attr,t);else if("tagName"===n.prop&&t!==l.tagName){const e=this.frame.contentDocument.createElement(t);e.innerHTML=l.innerHTML;for(const t of l.attributes)e.setAttribute(t.name,t.value);l.replaceWith(e),l===this.selectedElement&&(this.selectedElement=e)}}else{if("options"===n.type)return;{const s=e.value;n.attr?(s?l.setAttribute(n.attr,s):l.removeAttribute(n.attr),n.all&&t.querySelectorAll(n.selector).forEach(e=>{s?e.setAttribute(n.attr,s):e.removeAttribute(n.attr)})):"textContent"===n.prop?l.textContent=s:"innerHTML"===n.prop&&(l.innerHTML=s)}}this.syncToCode()}};o(a,"input","input[data-sidx]",(e,t)=>n(t)),o(a,"change","input[data-sidx]",(e,t)=>n(t)),o(a,"change","select[data-sidx]",(e,t)=>n(t)),a.addEventListener("click",e=>{const t=e.target.closest(".jse-toggle");if(!t)return;const s=t.previousElementSibling;s&&"checkbox"===s.type&&(s.checked=!s.checked,s.dispatchEvent(new Event("change",{bubbles:!0})))}),a.addEventListener("change",e=>{const t=e.target;if(!t.dataset.modalProp)return;const s=this._currentBlockRoot;if(!s)return;const o=s.querySelector(".modal-dialog"),a=s.querySelector(".shou-modal-close"),n=s.querySelector(".shou-modal-save");switch(t.dataset.modalProp){case"centered":o?.classList.toggle("modal-dialog-centered",t.checked);break;case"scrollable":o?.classList.toggle("modal-dialog-scrollable",t.checked);break;case"showClose":a&&(a.style.display=t.checked?"":"none");break;case"showSave":n&&(n.style.display=t.checked?"":"none")}this.syncToCode()});const l=e=>{if(!this.selectedElement)return;const t=this._findBlockRoot(this.selectedElement);if(!t)return;const s=t.getAttribute("data-jse-block"),o=s?this.getBlockById(s):null;if(!o)return;const a=parseInt(e.dataset.sidx,10),n=o.settings[a];if(!n)return;const l=n.selector?t.querySelector(n.selector):t;if(!l)return;const i=e.querySelectorAll(".jse-opt-row");l.innerHTML=Array.from(i).map(e=>{const t=e.querySelector("input[data-opt-val]"),s=e.querySelector("input[data-opt-txt]"),o=t?t.value:"",a=s?s.value:"";return o?`<option value="${o}">${a||o}</option>`:`<option>${a}</option>`}).join(""),this.syncToCode()};a.addEventListener("input",e=>{if(void 0!==e.target.dataset.optVal||void 0!==e.target.dataset.optTxt){const t=e.target.closest("[data-opt-editor]");t&&l(t)}}),a.addEventListener("click",e=>{const t=e.target.closest("[data-opt-del]");if(t){const e=t.closest(".jse-opt-row"),s=t.closest("[data-opt-editor]");return e&&e.remove(),void(s&&l(s))}const s=e.target.closest("[data-opt-add]");if(s){const e=s.closest("[data-opt-editor]");if(!e)return;const t=e.querySelectorAll(".jse-opt-row").length,o=document.createElement("div");o.className="jse-opt-row",o.style.cssText="display:flex;gap:4px;margin-bottom:4px;align-items:center",o.innerHTML=`<input type="text" data-opt-val="${t}" value="${t+1}" placeholder="${c("options.valuePlaceholder")}" style="flex:1;padding:4px 6px;border:1px solid var(--jse-border);border-radius:3px;background:var(--jse-bg);color:var(--jse-text);font-size:11px"><input type="text" data-opt-txt="${t}" value="Option ${t+1}" placeholder="${c("options.textPlaceholder")}" style="flex:2;padding:4px 6px;border:1px solid var(--jse-border);border-radius:3px;background:var(--jse-bg);color:var(--jse-text);font-size:11px"><button data-opt-del="${t}" style="padding:2px 6px;border:1px solid var(--jse-border);border-radius:3px;background:var(--jse-bg);color:var(--jse-text);cursor:pointer;font-size:11px;line-height:1" title="${c("toolbar.delete")}">&times;</button>`,s.before(o),l(e)}});const i=()=>{const e=this._currentBlockRoot;if(!e)return;const t=e.getAttribute("id")||"carousel1",s=e.querySelector(".carousel-inner"),o=e.querySelector(".carousel-indicators");if(!s)return;const n=a.querySelectorAll(".jse-slide-row"),l=Array.from(n).map(e=>{const t=e.querySelector("[data-slide-src]"),s=e.querySelector("[data-slide-alt]");return{src:t?t.value:"",alt:s?s.value:""}});s.innerHTML=l.map((e,t)=>`<div class="carousel-item${0===t?" active":""}"><img src="${e.src}" class="d-block w-100" alt="${e.alt}"></div>`).join(""),o&&(o.innerHTML=l.map((e,s)=>`<button type="button" data-bs-target="#${t}" data-bs-slide-to="${s}"${0===s?' class="active"':""}></button>`).join("")),this.syncToCode()},r=()=>{const e=this._currentBlockRoot;if(!e)return;const t=e.querySelector(".nav-tabs"),s=e.querySelector(".tab-content");if(!t||!s)return;const o=t.getAttribute("id")||"tabs1",n=Array.from(s.querySelectorAll(".tab-pane")),l=a.querySelectorAll(".jse-tab-row"),i=Array.from(l).map((e,t)=>{const s=e.querySelector("[data-tab-title]"),o=n[t];return{title:s?s.value:`Tab ${t+1}`,content:o?o.innerHTML:""}});t.innerHTML=i.map((e,t)=>`<li class="nav-item" role="presentation"><button class="nav-link${0===t?" active":""}" data-bs-toggle="tab" data-bs-target="#${o}-${t+1}" type="button" role="tab">${e.title}</button></li>`).join(""),s.innerHTML=i.map((e,t)=>`<div class="tab-pane fade${0===t?" show active":""}" id="${o}-${t+1}" role="tabpanel">${e.content}</div>`).join(""),this.syncToCode()},d=()=>{const e=this._currentBlockRoot;if(!e)return;const t=e.querySelector(".accordion");if(!t)return;const s=t.getAttribute("id")||"acc1",o=Array.from(t.querySelectorAll(".accordion-item")),n=a.querySelectorAll(".jse-accordion-row"),l=Array.from(n).map((e,t)=>{const s=e.querySelector("[data-acc-title]"),a=o[t],n=a?.querySelector(".accordion-body");return{title:s?s.value:`Sección ${t+1}`,content:n?n.innerHTML:`Contenido de la sección ${t+1}.`,isOpen:null!==a?.querySelector(".accordion-collapse.show")}});t.innerHTML=l.map((e,t)=>{const o=0===t,a=e.isOpen||l.every(e=>!e.isOpen)&&o;return`<div class="accordion-item">\n            <h2 class="accordion-header">\n              <button class="accordion-button${a?"":" collapsed"}" type="button" data-bs-toggle="collapse" data-bs-target="#${s}-c${t+1}">${e.title}</button>\n            </h2>\n            <div id="${s}-c${t+1}" class="accordion-collapse collapse${a?" show":""}" data-bs-parent="#${s}">\n              <div class="accordion-body">${e.content}</div>\n            </div>\n          </div>`}).join(""),this.syncToCode()},p=()=>{const e=this._currentBlockRoot;if(!e)return;const t=e.querySelector(".list-group");if(!t)return;const s=a.querySelectorAll(".jse-listitem-row"),o=Array.from(s).map((e,t)=>{const s=e.querySelector("[data-listitem-text]");return s?s.value:`Elemento ${t+1}`});t.innerHTML=o.map(e=>`<li class="list-group-item">${e}</li>`).join(""),this.syncToCode()},h=()=>{const e=this._currentBlockRoot;if(!e)return;const t=e.querySelector(".breadcrumb");if(!t)return;const s=a.querySelectorAll(".jse-breadcrumb-row"),o=Array.from(s).map((e,t)=>{const s=e.querySelector("[data-bc-text]"),o=e.querySelector("[data-bc-url]");return{text:s?s.value:`Link ${t+1}`,url:o?o.value:"#"}});t.innerHTML=o.map((e,t)=>t===o.length-1?`<li class="breadcrumb-item active" aria-current="page">${e.text}</li>`:`<li class="breadcrumb-item"><a href="${e.url}">${e.text}</a></li>`).join(""),this.syncToCode()};a.addEventListener("input",e=>{void 0!==e.target.dataset.slideSrc||void 0!==e.target.dataset.slideAlt?i():void 0!==e.target.dataset.tabTitle?r():void 0!==e.target.dataset.accTitle?d():void 0!==e.target.dataset.listitemText?p():void 0===e.target.dataset.bcText&&void 0===e.target.dataset.bcUrl||h()}),a.addEventListener("click",e=>{const t=e.target.closest("[data-slide-del]");if(t){const e=t.closest(".jse-slide-row");return void(e&&(e.remove(),a.querySelectorAll(".jse-slide-row").forEach((e,t)=>{e.dataset.slideIdx=t,e.querySelector("strong").textContent=`Slide ${t+1}`;const s=e.querySelector("[data-slide-src]"),o=e.querySelector("[data-slide-alt]"),a=e.querySelector("[data-slide-del]");s&&(s.dataset.slideSrc=t),o&&(o.dataset.slideAlt=t),a&&(a.dataset.slideDel=t)}),i()))}const s=e.target.closest("[data-slide-add]");if(s){const e=s.closest("[data-slides-editor]");if(!e)return;const t=e.querySelectorAll(".jse-slide-row").length,o=document.createElement("div");return o.className="jse-slide-row",o.dataset.slideIdx=t,o.style.cssText="display:flex;flex-direction:column;gap:4px;margin-bottom:8px;padding:8px;border:1px solid var(--jse-border);border-radius:4px;background:var(--jse-bg-alt)",o.innerHTML=`\n            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:4px">\n              <strong style="font-size:11px;color:var(--jse-text-muted)">Slide ${t+1}</strong>\n              <button type="button" data-slide-del="${t}" style="padding:2px 6px;border:1px solid var(--jse-border);border-radius:3px;background:var(--jse-bg);color:var(--jse-text);cursor:pointer;font-size:11px;line-height:1" title="${c("toolbar.delete")}">&times;</button>\n            </div>\n            <input type="text" data-slide-src="${t}" value="https://picsum.photos/1200/500?random=${t+10}" placeholder="${c("setting.slideUrl")}" style="width:100%;padding:4px 6px;border:1px solid var(--jse-border);border-radius:3px;background:var(--jse-bg);color:var(--jse-text);font-size:11px">\n            <input type="text" data-slide-alt="${t}" value="Slide ${t+1}" placeholder="${c("setting.slideAlt")}" style="width:100%;padding:4px 6px;border:1px solid var(--jse-border);border-radius:3px;background:var(--jse-bg);color:var(--jse-text);font-size:11px">\n          `,s.before(o),void i()}const o=e.target.closest("[data-tab-del]");if(o){const e=o.closest(".jse-tab-row");return void(e&&(e.remove(),a.querySelectorAll(".jse-tab-row").forEach((e,t)=>{e.dataset.tabIdx=t;const s=e.querySelector("[data-tab-title]"),o=e.querySelector("[data-tab-del]");s&&(s.dataset.tabTitle=t),o&&(o.dataset.tabDel=t)}),r(),this.updateAttrInputs()))}if(e.target.closest("[data-tab-add]")){const e=this._currentBlockRoot;if(!e)return;const t=e.querySelector(".nav-tabs"),s=e.querySelector(".tab-content");if(!t||!s)return;const o=t.getAttribute("id")||"tabs1",a=t.querySelectorAll(".nav-link").length,n=document.createElement("li");n.className="nav-item",n.setAttribute("role","presentation"),n.innerHTML=`<button class="nav-link" data-bs-toggle="tab" data-bs-target="#${o}-${a+1}" type="button" role="tab">Tab ${a+1}</button>`,t.appendChild(n);const l=document.createElement("div");l.className="tab-pane fade",l.id=`${o}-${a+1}`,l.setAttribute("role","tabpanel"),l.innerHTML='<p class="text-muted">Arrastra bloques aquí</p>',s.appendChild(l),this.syncToCode(),this.updateAttrInputs()}const n=e.target.closest("[data-acc-del]");if(n){const e=n.closest(".jse-accordion-row");return void(e&&(e.remove(),a.querySelectorAll(".jse-accordion-row").forEach((e,t)=>{e.dataset.accIdx=t;const s=e.querySelector("[data-acc-title]"),o=e.querySelector("[data-acc-del]");s&&(s.dataset.accTitle=t),o&&(o.dataset.accDel=t)}),d(),this.updateAttrInputs()))}if(e.target.closest("[data-acc-add]")){const e=this._currentBlockRoot;if(!e)return;const t=e.querySelector(".accordion");if(!t)return;const s=t.getAttribute("id")||"acc1",o=t.querySelectorAll(".accordion-item").length,a=document.createElement("div");a.className="accordion-item",a.innerHTML=`\n            <h2 class="accordion-header">\n              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#${s}-c${o+1}">Sección ${o+1}</button>\n            </h2>\n            <div id="${s}-c${o+1}" class="accordion-collapse collapse" data-bs-parent="#${s}">\n              <div class="accordion-body"><p class="text-muted">Arrastra bloques aquí</p></div>\n            </div>\n          `,t.appendChild(a),this.syncToCode(),this.updateAttrInputs()}const l=e.target.closest("[data-listitem-del]");if(l){const e=l.closest(".jse-listitem-row");return void(e&&(e.remove(),a.querySelectorAll(".jse-listitem-row").forEach((e,t)=>{e.dataset.listitemIdx=t;const s=e.querySelector("[data-listitem-text]"),o=e.querySelector("[data-listitem-del]");s&&(s.dataset.listitemText=t),o&&(o.dataset.listitemDel=t)}),p(),this.updateAttrInputs()))}if(e.target.closest("[data-listitem-add]")){const e=this._currentBlockRoot;if(!e)return;const t=e.querySelector(".list-group");if(!t)return;const s=t.querySelectorAll(".list-group-item").length,o=document.createElement("li");o.className="list-group-item",o.textContent=`Elemento ${s+1}`,t.appendChild(o),this.syncToCode(),this.updateAttrInputs()}const b=e.target.closest("[data-bc-del]");if(b){const e=b.closest(".jse-breadcrumb-row");return void(e&&(e.remove(),a.querySelectorAll(".jse-breadcrumb-row").forEach((e,t)=>{e.dataset.bcIdx=t;const s=e.querySelector("[data-bc-text]"),o=e.querySelector("[data-bc-url]"),a=e.querySelector("[data-bc-del]");s&&(s.dataset.bcText=t),o&&(o.dataset.bcUrl=t),a&&(a.dataset.bcDel=t)}),h(),this.updateAttrInputs()))}if(e.target.closest("[data-bc-add]")){const e=this._currentBlockRoot;if(!e)return;const t=e.querySelector(".breadcrumb");if(!t)return;const s=t.querySelectorAll(".breadcrumb-item"),o=s.length,a=document.createElement("li");a.className="breadcrumb-item",a.innerHTML=`<a href="#">Enlace ${o}</a>`;const n=s[s.length-1];n?t.insertBefore(a,n):t.appendChild(a),this.syncToCode(),this.updateAttrInputs()}})}toggleFullscreen(){const e=this.root.classList.toggle("jse-fullscreen"),t=this.root.querySelector(".jse-fullscreen-btn");if(t&&(t.innerHTML=e?p.exitFullscreen:p.fullscreen),t&&(t.title=e?"Exit fullscreen":c("btn.fullscreen")),e){this._origWidth=this.root.style.width,this._origHeight=this.root.style.height;let e=0;for(const t of document.querySelectorAll("*")){const s=parseInt(getComputedStyle(t).zIndex,10);s>e&&(e=s)}this.root.style.zIndex=e+10}else this.root.style.width=this._origWidth||"",this.root.style.height=this._origHeight||"",this.root.style.zIndex=""}_initPanelResize(){const e=this.root.querySelector(".jse-resize-left"),t=this.root.querySelector(".jse-resize-right"),s=this.root.querySelector(".jse-panel-left"),o=this.root.querySelector(".jse-panel-right"),a=(e,t,s)=>{e&&t&&e.addEventListener("mousedown",o=>{o.preventDefault();const a=o.clientX,n=t.offsetWidth;e.classList.add("dragging"),document.body.style.cursor="col-resize",document.body.style.userSelect="none";const l=document.createElement("div");l.style.cssText="position:fixed;inset:0;z-index:99999;cursor:col-resize",document.body.appendChild(l);const i=e=>{const o="left"===s?e.clientX-a:a-e.clientX,l=Math.max(150,Math.min(500,n+o));t.style.width=l+"px",t.style.minWidth=l+"px"},r=()=>{e.classList.remove("dragging"),document.body.style.cursor="",document.body.style.userSelect="",l.remove(),document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",r)};document.addEventListener("mousemove",i),document.addEventListener("mouseup",r)})};a(e,s,"left"),a(t,o,"right")}initFrame(){if(!this.frame)return;const e=`<!DOCTYPE html>\n<html><head>\n<meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1">\n<link href="${this.config.bootstrapCss}" rel="stylesheet">\n<style>\nbody{min-height:100vh;padding:10px}\n[data-selected]{outline:none!important;box-shadow:inset 0 0 0 3px #f97316!important;position:relative;z-index:1}\n[data-hover]:not([data-selected]){outline:2px dashed #007acc!important;outline-offset:-2px}\n.jse-drop-indicator{position:absolute;pointer-events:none;z-index:9999;left:0;height:3px;background:#007acc;border-radius:2px;box-shadow:0 0 8px rgba(0,122,204,0.6);transition:top .08s ease,left .08s ease,width .08s ease}\n.jse-drop-indicator::before,.jse-drop-indicator::after{content:'';position:absolute;top:-4px;width:11px;height:11px;border-radius:50%;background:#007acc;box-shadow:0 0 4px rgba(0,122,204,0.5)}\n.jse-drop-indicator::before{left:-2px}\n.jse-drop-indicator::after{right:-2px}\n.jse-drop-indicator.drop-inside{height:auto;background:rgba(0,122,204,0.06);border:2px dashed #007acc;border-radius:4px;box-shadow:none}\n.jse-drop-indicator.drop-inside::before,.jse-drop-indicator.drop-inside::after{display:none}\n.jse-drop-indicator.drop-horizontal{width:3px!important;height:auto;border-radius:2px}\n.jse-drop-indicator.drop-horizontal::before,.jse-drop-indicator.drop-horizontal::after{left:-4px;top:auto;width:11px;height:11px}\n.jse-drop-indicator.drop-horizontal::before{top:-2px}\n.jse-drop-indicator.drop-horizontal::after{top:auto;bottom:-2px;right:auto;left:-4px}\n.jse-element-toolbar{position:absolute;display:flex;gap:2px;padding:3px;background:#007acc;border-radius:5px;box-shadow:0 2px 8px rgba(0,0,0,0.3);z-index:9998;align-items:center}\n.jse-element-toolbar button{width:24px;height:24px;border:none;background:rgba(255,255,255,0.15);color:#fff;border-radius:3px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:background .15s;padding:0}\n.jse-element-toolbar button:hover{background:rgba(255,255,255,0.35)}\n.jse-element-toolbar button svg{width:14px;height:14px;fill:currentColor}\n.jse-drag-handle{cursor:grab!important;width:26px!important;height:26px!important;background:rgba(255,255,255,0.25)!important;border-radius:4px!important}\n.jse-drag-handle:active{cursor:grabbing!important}\n.jse-drag-handle svg{width:16px;height:16px;fill:currentColor;pointer-events:none}\n.jse-tb-sep{width:1px;height:18px;background:rgba(255,255,255,0.25);margin:0 2px}\n.jse-element-dragging{opacity:0.4!important;outline:2px dashed #007acc!important}\n.jse-show-outlines div,.jse-show-outlines section,.jse-show-outlines article,.jse-show-outlines header,.jse-show-outlines footer,.jse-show-outlines nav,.jse-show-outlines aside,.jse-show-outlines main{outline:1px dashed rgba(0,122,204,0.4)!important;outline-offset:-1px}\n.jse-show-outlines div:hover,.jse-show-outlines section:hover{outline-color:rgba(0,122,204,0.8)!important}\n</style>\n</head><body></body></html>`;this.frame.srcdoc=e,this.frame.onload=()=>this.setupFrame()}setupFrame(){const e=this.frame?.contentDocument;if(!e)return;const t=e.body;this.dropIndicator=null,this.dropTarget=null,this.elementToolbar=null,t.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation();const s=e.target.closest('[data-bs-toggle="tab"]');if(s){const e=s.getAttribute("data-bs-target");if(e){const t=s.closest(".shou-tabs-wrapper");if(t){t.querySelectorAll(".nav-link").forEach(e=>e.classList.remove("active")),t.querySelectorAll(".tab-pane").forEach(e=>{e.classList.remove("show","active")}),s.classList.add("active");const o=t.querySelector(e);o&&o.classList.add("show","active")}}}const o=e.target.closest(".shou-modal-trigger");if(o){const e=o.closest(".shou-modal-wrapper");if(e){const t=e.querySelector(".shou-modal-overlay");t&&(t.style.display="block")}}const a=e.target.closest(".shou-modal-close, .shou-modal-close-x"),n=e.target.classList.contains("shou-modal-overlay");if(a||n){const t=a?a.closest(".shou-modal-overlay"):e.target;t&&(t.style.display="none")}const l=e.target.closest('[data-bs-toggle="collapse"]');if(l){const e=l.closest(".shou-accordion-wrapper");if(e){const t=l.getAttribute("data-bs-target"),s=t?e.querySelector(t):null;if(s){const e=s.classList.contains("show"),t=l.closest(".accordion");s.getAttribute("data-bs-parent")&&t&&t.querySelectorAll(".accordion-collapse.show").forEach(e=>{if(e!==s){e.classList.remove("show");const s=t.querySelector(`[data-bs-target="#${e.id}"]`);s&&s.classList.add("collapsed")}}),e?(s.classList.remove("show"),l.classList.add("collapsed")):(s.classList.add("show"),l.classList.remove("collapsed")),this.syncToCode()}}}this.selectElement(e.target===t?null:e.target)}),t.addEventListener("dblclick",e=>{e.preventDefault(),e.stopPropagation(),this.selectedElement&&this.selectedElement.parentNode&&this.selectedElement.parentNode!==t&&this.selectElement(this.selectedElement.parentNode)}),t.addEventListener("mouseover",e=>{e.target===t||e.target===this.selectedElement||e.target.classList.contains("jse-drop-indicator")||e.target.closest(".jse-element-toolbar")||e.target.setAttribute("data-hover","true")}),t.addEventListener("mouseout",e=>e.target.removeAttribute("data-hover")),t.addEventListener("dragover",t=>{t.preventDefault(),t.dataTransfer.dropEffect="copy",this.showDropIndicator(t,e)}),t.addEventListener("dragleave",s=>{s.target!==t&&t.contains(s.relatedTarget)||this.hideDropIndicator(e)}),t.addEventListener("drop",t=>{t.preventDefault();const s=t.dataTransfer.getData("text/plain");s&&this.dropTarget&&this.insertBlockAtPosition(s,this.dropTarget.element,this.dropTarget.position),this.hideDropIndicator(e)}),t.addEventListener("dblclick",e=>{e.target===t||e.target.closest(".jse-element-toolbar")||(e.target.contentEditable="true",e.target.focus())}),t.addEventListener("blur",e=>{"true"===e.target.contentEditable&&(e.target.contentEditable="false",this.syncToCode())},!0),t.addEventListener("keydown",e=>{const s=e.ctrlKey||e.metaKey;return s&&"z"===e.key?(e.preventDefault(),void(e.shiftKey?this.redo():this.undo())):s&&"y"===e.key?(e.preventDefault(),void this.redo()):void(s&&"c"===e.key&&this.selectedElement?(e.preventDefault(),this.clipboard=this.selectedElement.outerHTML):s&&"x"===e.key&&this.selectedElement?(e.preventDefault(),this.clipboard=this.selectedElement.outerHTML,this.deleteSelected()):s&&"v"===e.key&&this.clipboard?(e.preventDefault(),this.selectedElement?this.selectedElement.insertAdjacentHTML("afterend",this.clipboard):t.insertAdjacentHTML("beforeend",this.clipboard),this.syncToCode(),this.updateLayers()):this.selectedElement&&"Delete"===e.key?this.deleteSelected():this.selectedElement&&"Escape"===e.key?this.selectElement(null):this.selectedElement&&e.altKey&&"ArrowUp"===e.key?(e.preventDefault(),this._moveElementUp()):this.selectedElement&&e.altKey&&"ArrowDown"===e.key?(e.preventDefault(),this._moveElementDown()):this.selectedElement&&e.altKey&&"ArrowLeft"===e.key?(e.preventDefault(),this._moveElementOut()):this.selectedElement&&e.altKey&&"ArrowRight"===e.key&&(e.preventDefault(),this._moveElementInto()))}),this.updateLayers(),this._outlinesActive&&t.classList.add("jse-show-outlines")}_isHorizontalLayout(e){const t=e.ownerDocument.defaultView;if(!t)return!1;const s=t.getComputedStyle(e),o=s.display;if("flex"===o||"inline-flex"===o){const e=s.flexDirection;return"row"===e||"row-reverse"===e||""===e}if("grid"===o||"inline-grid"===o){const e=s.gridTemplateColumns;return e&&e.split(" ").filter(e=>e&&"none"!==e).length>1}return!1}_resolveDropTarget(e,t,s,o){const a=e.body;let n=e.elementFromPoint(t,s);if(!n||n.classList.contains("jse-drop-indicator"))return null;if(n.closest(".jse-element-toolbar"))return null;if(o&&(n===o||n.closest(".jse-element-dragging")))return null;if(n===a)return{element:a,position:"append"};let l=n;for(;l&&l!==a;){const e=l.parentNode;if(!e||1!==e.nodeType&&e!==a)break;const n=this._getDropChildren(e,o);if(0===n.length){l=e;continue}const i=this._isHorizontalLayout(e),r=this._findBestGap(n,e,t,s,i,o);if(r)return r;l=e}const i=n.getBoundingClientRect();if(!!n.parentNode&&this._isHorizontalLayout(n.parentNode)){return{element:n,position:t-i.left<i.width/2?"before":"after",horizontal:!0}}return{element:n,position:s-i.top<i.height/2?"before":"after"}}_getDropChildren(e,t){return Array.from(e.children).filter(e=>!e.classList.contains("jse-drop-indicator")&&!e.classList.contains("jse-element-toolbar")&&e!==t&&!e.classList.contains("jse-element-dragging"))}_findBestGap(e,t,s,o,a,n){if(0===e.length)return{element:t,position:"inside"};const l=a?s:o,i=[];for(let t=0;t<=e.length;t++){let s;if(0===t){const t=e[0].getBoundingClientRect();s=a?t.left:t.top}else if(t===e.length){const t=e[e.length-1].getBoundingClientRect();s=a?t.right:t.bottom}else{const o=e[t-1].getBoundingClientRect(),n=e[t].getBoundingClientRect();s=((a?o.right:o.bottom)+(a?n.left:n.top))/2}i.push({pos:s,index:t,element:t<e.length?e[t]:e[e.length-1],position:t<e.length?"before":"after"})}let r=null,c=1/0;for(const e of i){const t=Math.abs(l-e.pos);t<c&&(c=t,r=e)}r&&a&&(r.horizontal=!0);for(const t of e){const e=t.getBoundingClientRect(),i=s>=e.left&&s<=e.right,r=o>=e.top&&o<=e.bottom;if(i&&r){const i=!["IMG","BR","HR","INPUT","TEXTAREA","SELECT","BUTTON","A"].includes(t.tagName),r=a?s-e.left:o-e.top,c=a?e.right-s:e.bottom-o,d=a?e.width:e.height,p=Math.min(.25*d,20);if(r<p)return{element:t,position:"before",horizontal:a};if(c<p)return{element:t,position:"after",horizontal:a};if(i&&t.children.length>0){const e=this._getDropChildren(t,n);if(e.length>0){const a=this._isHorizontalLayout(t);return this._findBestGap(e,t,s,o,a,n)}}if(i)return{element:t,position:"inside"};return{element:t,position:l<(a?(e.left+e.right)/2:(e.top+e.bottom)/2)?"before":"after",horizontal:a}}}return r}showDropIndicator(e,t){this.dropIndicator||(this.dropIndicator=t.createElement("div"),this.dropIndicator.className="jse-drop-indicator");const s=this._resolveDropTarget(t,e.clientX,e.clientY,null);s&&(this.dropTarget=s,this._positionIndicator(s,t))}hideDropIndicator(e){this.dropIndicator&&this.dropIndicator.parentNode&&this.dropIndicator.remove(),this.dropTarget=null}_positionIndicator(e,t){const s=t.body,o=t.documentElement.scrollTop||s.scrollTop,a=t.documentElement.scrollLeft||s.scrollLeft,{element:n,position:l,horizontal:i}=e;if(this.dropIndicator.classList.remove("drop-horizontal","drop-inside"),"append"===l){const e=s.getBoundingClientRect();this.dropIndicator.className="jse-drop-indicator",this.dropIndicator.style.top=s.scrollHeight-4+"px",this.dropIndicator.style.left="4px",this.dropIndicator.style.width=e.width-8+"px",this.dropIndicator.style.height=""}else if("inside"===l){const e=n.getBoundingClientRect();this.dropIndicator.className="jse-drop-indicator drop-inside",this.dropIndicator.style.left=e.left+a+"px",this.dropIndicator.style.top=e.top+o+"px",this.dropIndicator.style.width=e.width+"px",this.dropIndicator.style.height=e.height+"px"}else if(i){const e=n.getBoundingClientRect();this.dropIndicator.className="jse-drop-indicator drop-horizontal";const t="before"===l?e.left:e.right;this.dropIndicator.style.left=t+a-2+"px",this.dropIndicator.style.top=e.top+o+"px",this.dropIndicator.style.width="3px",this.dropIndicator.style.height=e.height+"px"}else{const e=n.getBoundingClientRect();this.dropIndicator.className="jse-drop-indicator",this.dropIndicator.style.left=e.left+a+"px",this.dropIndicator.style.width=e.width+"px",this.dropIndicator.style.height="",this.dropIndicator.style.top="before"===l?e.top+o-2+"px":e.bottom+o-1+"px"}this.dropIndicator.parentNode||s.appendChild(this.dropIndicator)}insertBlockAtPosition(e,t,s){const o=this.getBlockById(e);if(!o||!this.frame?.contentDocument)return;o.css&&this.injectBlockCSS(o);const a=this.frame.contentDocument.body,n=this._htmlToElement(o.html);n&&(n.setAttribute("data-jse-block",o.id),"append"===s||t===a?a.appendChild(n):"inside"===s?t.appendChild(n):"before"===s?t.before(n):t.after(n),this.syncToCode(),this.updateLayers())}createElementToolbar(e){this.elementToolbar&&this.elementToolbar.remove();const t=e.createElement("div");t.className="jse-element-toolbar";const s=this.selectedElement&&"IMG"===this.selectedElement.tagName;t.innerHTML=`\n        <button type="button" class="jse-drag-handle" title="${c("toolbar.drag")}">${p.drag}</button>\n        <span class="jse-tb-sep"></span>\n        ${s?`<button type="button" data-action="edit-image" title="${c("toolbar.editImage")}">${p.editImage}</button>`:""}\n        <button type="button" data-action="duplicate" title="${c("toolbar.duplicate")}">${p.duplicate}</button>\n        <button type="button" data-action="delete" title="${c("toolbar.delete")}">${p.delete}</button>\n      `;const o=t.querySelector(".jse-drag-handle");return this.setupDragHandle(o,e),t.addEventListener("click",e=>{const t=e.target.closest("button[data-action]");if(!t)return;e.stopPropagation();const s=t.dataset.action;"duplicate"===s?(this.selectedElement.insertAdjacentHTML("afterend",this.selectedElement.outerHTML),this.syncToCode(),this.updateLayers()):"delete"===s?this.deleteSelected():"edit-image"===s&&"IMG"===this.selectedElement?.tagName&&this.openImageEditor(this.selectedElement)}),this.elementToolbar=t,t}setupDragHandle(e,t){let s=!1,o=null;e.addEventListener("mousedown",e=>{if(e.preventDefault(),e.stopPropagation(),!this.selectedElement)return;s=!0,o=this.selectedElement,o.classList.add("jse-element-dragging"),this.elementToolbar&&(this.elementToolbar.style.display="none");const a=e=>{s&&this.showMoveIndicator(e,t,o)},n=e=>{s&&(s=!1,o.classList.remove("jse-element-dragging"),this.dropTarget&&this.dropTarget.element!==o&&this.moveElementToPosition(o,this.dropTarget.element,this.dropTarget.position),this.hideDropIndicator(t),this.elementToolbar&&(this.elementToolbar.style.display="flex"),this.updateToolbarPosition(),t.removeEventListener("mousemove",a),t.removeEventListener("mouseup",n))};t.addEventListener("mousemove",a),t.addEventListener("mouseup",n)})}showMoveIndicator(e,t,s){this.dropIndicator||(this.dropIndicator=t.createElement("div"),this.dropIndicator.className="jse-drop-indicator");const o=this._resolveDropTarget(t,e.clientX,e.clientY,s);o&&(this.dropTarget=o,this._positionIndicator(o,t))}moveElementToPosition(e,t,s){const o=this.frame?.contentDocument?.body;o&&("append"===s||t===o?o.appendChild(e):"inside"===s?t.appendChild(e):"before"===s?t.parentNode.insertBefore(e,t):t.parentNode.insertBefore(e,t.nextSibling),this.syncToCode(),this.updateLayers())}_moveElementUp(){const e=this.selectedElement;if(!e)return;const t=e.previousElementSibling;!t||t.classList.contains("jse-element-toolbar")||t.classList.contains("jse-drop-indicator")||(e.parentNode.insertBefore(e,t),this.syncToCode(),this.updateLayers(),this.updateToolbarPosition())}_moveElementDown(){const e=this.selectedElement;if(!e)return;const t=e.nextElementSibling;!t||t.classList.contains("jse-element-toolbar")||t.classList.contains("jse-drop-indicator")||(e.parentNode.insertBefore(t,e),this.syncToCode(),this.updateLayers(),this.updateToolbarPosition())}_moveElementOut(){const e=this.selectedElement;if(!e)return;const t=e.parentNode,s=this.frame?.contentDocument?.body;t&&t!==s&&(t.parentNode.insertBefore(e,t.nextSibling),this.syncToCode(),this.updateLayers(),this.updateToolbarPosition())}_moveElementInto(){const e=this.selectedElement;if(!e)return;const t=e.nextElementSibling,s=e.previousElementSibling,o=e=>e&&1===e.nodeType&&!["IMG","BR","HR","INPUT","TEXTAREA","SELECT","BUTTON"].includes(e.tagName)&&!e.classList.contains("jse-element-toolbar")&&!e.classList.contains("jse-drop-indicator");if(o(t))t.insertBefore(e,t.firstChild);else{if(!o(s))return;s.appendChild(e)}this.syncToCode(),this.updateLayers(),this.updateToolbarPosition()}openImageEditor(e){if(!e||"IMG"!==e.tagName)return;if("undefined"==typeof JSImageEditor)return;const t=document.createElement("div");t.className="jse-image-modal",t.innerHTML='<div class="jse-image-modal-content"></div>',this.root.appendChild(t);const s=t.querySelector(".jse-image-modal-content");JSImageEditor.init(s,{theme:this.config.theme,width:"100%",height:"100%",lang:this.config.lang,onSave:s=>{e.src=s,this.syncToCode(),this.saveToStorage(),t.remove()},onCancel:()=>{t.remove()}}).loadImage(e.src)}updateToolbarPosition(){if(!this.elementToolbar||!this.selectedElement)return;const e=this.selectedElement.getBoundingClientRect(),t=this.frame?.contentDocument;if(!t)return;const s=t.documentElement.scrollTop||t.body.scrollTop;this.elementToolbar.style.left=e.left+"px",e.top<36?(this.elementToolbar.style.top=e.bottom+s+6+"px",this.elementToolbar.style.transform="none"):(this.elementToolbar.style.top=e.top+s+"px",this.elementToolbar.style.transform="translateY(-100%)",this.elementToolbar.style.marginTop="-6px")}selectElement(e){const t=this.frame?.contentDocument;if(t){if(t.querySelectorAll("[data-selected]").forEach(e=>e.removeAttribute("data-selected")),this.elementToolbar&&(this.elementToolbar.remove(),this.elementToolbar=null),this.selectedElement=e,e){e.setAttribute("data-selected","true");const s=this.createElementToolbar(t);t.body.appendChild(s),this.updateToolbarPosition()}this.updateSelectedInfo(),this.updateCanvasBreadcrumb(),this.updateStyleInputs(),this.updateAttrInputs(),this.highlightLayerForElement(e),this._highlightInCodeEditor(e)}}updateCanvasBreadcrumb(){const e=[this.canvasBreadcrumb,this.codeBreadcrumb].filter(Boolean);if(!e.length)return;if(!this.selectedElement)return void e.forEach(e=>{e.classList.remove("visible"),e.innerHTML=""});const t=this.frame?.contentDocument?.body,s=[];let o=this.selectedElement;for(;o&&o!==t;)s.unshift(o),o=o.parentNode;const a=s.map((e,t)=>{const o=e.tagName.toLowerCase(),a=e.className?"."+String(e.className).split(" ")[0]:"";return`<span class="jse-breadcrumb${t===s.length-1?" active":""}" data-bc-idx="${t}">${o}${a}</span>`}).join('<span class="jse-bc-sep"> › </span>');e.forEach(e=>{e.innerHTML=a,e.classList.add("visible"),e.querySelectorAll(".jse-breadcrumb").forEach(e=>{e.addEventListener("click",()=>{const t=parseInt(e.dataset.bcIdx);s[t]&&this.selectElement(s[t])})})})}updateSelectedInfo(){if(!this.selectedInfo)return;if(!this.selectedElement)return void(this.selectedInfo.innerHTML='<span class="jse-no-sel">'+c("empty.selectElement")+"</span>");const e=this.selectedElement.tagName.toLowerCase(),t=this.selectedElement.className?`.${String(this.selectedElement.className).split(" ").slice(0,2).join(".")}`:"";this.selectedInfo.innerHTML=`<strong>&lt;${e}&gt;</strong> ${t}`}_highlightInCodeEditor(e){const t=this.codeEditors.html;if(!t?.textarea)return;if(this._codeHighlightEl&&(this._codeHighlightEl.remove(),this._codeHighlightEl=null),!e)return;const s=e.tagName.toLowerCase(),o=e.outerHTML,a=o.indexOf(">");if(a<0)return;let n=o.substring(0,a+1).replace(/\s*data-jse-block="[^"]*"/g,"").replace(/\s*data-selected="[^"]*"/g,"").replace(/\s*data-hover="[^"]*"/g,"");const l=this.code.html;let i=l.indexOf(n);if(i<0){const t=e.getAttribute("class"),o=t?`<${s} class="${t}"`:`<${s}`,a=this.frame?.contentDocument?.body;if(!a)return;const n=a.querySelectorAll(t?`${s}.${t.split(" ")[0]}`:s);let r=0;for(let t=0;t<n.length;t++)if(n[t]===e){r=t;break}let c=-1;for(let e=0;e<=r;e++)if(c=l.indexOf(o,c+1),c<0)return;i=c}if(i<0)return;let r;if(new Set(["img","br","hr","input","meta","link","area","base","col","embed","source","track","wbr"]).has(s))r=l.indexOf(">",i)+1;else{let e=0;const t=new RegExp(`<${s}[\\s>/]`,"gi"),o=new RegExp(`</${s}>`,"gi");t.lastIndex=i,o.lastIndex=i,e=1;const a=l.indexOf(">",i)+1;for(t.lastIndex=a,o.lastIndex=a;e>0;){const s=t.exec(l),a=o.exec(l);if(!a){r=l.length;break}s&&s.index<a.index?(e++,o.lastIndex=s.index+1,t.lastIndex=s.index+1):(e--,0===e?r=a.index+a[0].length:(t.lastIndex=a.index+1,o.lastIndex=a.index+1))}}r||(r=l.indexOf(">",i)+1);const c=t.textarea;c.focus(),c.setSelectionRange(i,r);const d=(l.substring(0,i).split("\n").length-1)*(parseFloat(getComputedStyle(c).lineHeight)||20.8)-c.clientHeight/3;c.scrollTop=Math.max(0,d),t.highlight?.parentElement&&(t.highlight.parentElement.scrollTop=c.scrollTop),t.lines&&(t.lines.scrollTop=c.scrollTop)}_detectFoldRegions(e,t){const s=e.split("\n"),o=[];if("html"===t){const e=new Set(["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr"]),t=[];for(let a=0;a<s.length;a++){const n=s[a],l=/<([a-zA-Z][a-zA-Z0-9]*)\b[^>]*?(?:\/)?>/g;let i;for(;i=l.exec(n);){const s=i[1].toLowerCase();e.has(s)||(i[0].endsWith("/>")||t.push({tag:s,line:a}))}const r=/<\/([a-zA-Z][a-zA-Z0-9]*)\s*>/g;for(;i=r.exec(n);){const e=i[1].toLowerCase();for(let s=t.length-1;s>=0;s--)if(t[s].tag===e){const e=t[s].line;a>e&&o.push({start:e,end:a}),t.splice(s,1);break}}}}else{const e="js"===t?["{","(","["]:["{"],a="js"===t?["}",")","]"]:["}"],n=[];for(let t=0;t<s.length;t++){const l=s[t];let i=!1,r="";for(let s=0;s<l.length;s++){const c=l[s];if(i){c===r&&"\\"!==l[s-1]&&(i=!1);continue}if('"'===c||"'"===c||"`"===c){i=!0,r=c;continue}if("/"===c&&"/"===l[s+1])break;const d=e.indexOf(c);if(d>=0)n.push({bracket:c,closer:a[d],line:t});else{if(a.indexOf(c)>=0)for(let e=n.length-1;e>=0;e--)if(n[e].closer===c){const s=n[e].line;t>s&&o.push({start:s,end:t}),n.splice(e,1);break}}}}}return o.sort((e,t)=>e.start-t.start||t.end-t.start-(e.end-e.start)),o}_buildDisplayCode(e){const t=this.code[e].split("\n"),s=this._foldState[e],o=this._foldRegions[e],a=[],n=[];let l=0;for(;l<t.length;){const e=o.find(e=>e.start===l);e&&s.has(l)?(a.push(t[l]+" ▸…"),n.push(l),l=e.end+1):(a.push(t[l]),n.push(l),l++)}return this._displayToRealMap[e]=n,this._displayCode[e]=a.join("\n"),this._displayCode[e]}_displayToRealCode(e,t){const s=t.split("\n"),o=this.code[e].split("\n"),a=(this._displayToRealMap[e],this._foldState[e]),n=this._foldRegions[e],l=[];let i=0;for(let e=0;e<o.length;e++){const t=n.find(t=>t.start===e&&a.has(e));if(t){if(i<s.length){let e=s[i];e=e.replace(/\s*\u25B8\u2026$/,""),l.push(e)}else l.push(o[e]);for(let s=e+1;s<=t.end;s++)l.push(o[s]);e=t.end,i++}else i<s.length&&l.push(s[i]),i++}for(;i<s.length;)l.push(s[i]),i++;return l.join("\n")}_renderFoldableLines(e){const t=this.codeEditors[e];if(!t?.lines)return;const s=this._displayToRealMap[e],o=this._foldRegions[e],a=this._foldState[e],n=(this._displayCode[e]||this.code[e]).split("\n").length,l=[];for(let e=0;e<n;e++){const t=void 0!==s[e]?s[e]:e,n=o.find(e=>e.start===t),i=t+1;if(n){const e=a.has(t),s=e?"▶":"▼";l.push(`<span><span class="jse-fold" data-fold-line="${t}" title="${e?"Unfold":"Fold"}">${s}</span>${i}</span>`)}else l.push(`<span>${i}</span>`)}t.lines.innerHTML=l.join("\n")}_toggleFold(e,t){const s=this._foldState[e];s.has(t)?s.delete(t):s.add(t),this._refreshCodeEditor(e)}_refreshCodeEditor(e){this._foldRegions[e]=this._detectFoldRegions(this.code[e],e);for(const t of this._foldState[e])this._foldRegions[e].some(e=>e.start===t)||this._foldState[e].delete(t);const t=this._buildDisplayCode(e),s=this.codeEditors[e];if(!s)return;const o=s.textarea,a=o?o.selectionStart:0;if(o&&(o.value=t),s.highlight&&(s.highlight.innerHTML=m(t,e)||"<br>"),this._renderFoldableLines(e),o){const e=Math.min(a,t.length);o.setSelectionRange(e,e)}}_buildStylesPanel(){const e=t(".jse-styles-editor",this.stylesPanel);if(!e||e.children.length)return;const s=(this.stylesDef||u).sections;e.innerHTML=s.map((e,t)=>{const s=e.props.map(e=>{let t;if("color"===e.type)t=`<input type="color" data-style="${e.style}">`;else if("select"===e.type){const s=(e.options||[]).map(e=>`<option value="${e}">${e||"(none)"}</option>`).join("");t=`<select data-style="${e.style}">${s}</select>`}else t=`<input type="text" data-style="${e.style}"${e.placeholder?` placeholder="${e.placeholder}"`:""}>`;return`<div class="jse-row"><label>${e.label}</label>${t}</div>`}).join("");return`<div class="jse-style-section${0===t?" open":""}">\n          <div class="jse-section-header"><span>${c(e.label)}</span><span class="jse-chevron">${p.chevron}</span></div>\n          <div class="jse-section-body">${s}</div>\n        </div>`}).join("")}updateStyleInputs(){this.selectedElement&&(this._buildStylesPanel(),s("[data-style]",this.stylesPanel).forEach(e=>{const t=e.dataset.style,s=this.selectedElement.style[t]||"";e.tagName,e.value=s}))}updateAttrInputs(){const e=this.attrsPanel,t=this.attrsInfo;if(!e)return;if(!this.selectedElement)return e.innerHTML="",void(t&&(t.innerHTML='<span class="jse-no-sel">'+c("empty.selectElement")+"</span>"));const s=this.selectedElement,o=s.tagName.toLowerCase(),a=s.className?`.${String(s.className).split(" ").slice(0,2).join(".")}`:"";t&&(t.innerHTML=`<strong>&lt;${o}&gt;</strong> ${a}`);const n=this._findBlockRoot(s),l=n?n.getAttribute("data-jse-block"):null,i=l?this.getBlockById(l):null;if(this._currentBlockRoot=n,i&&i.settings?.length)e.innerHTML=i.settings.map((e,t)=>{const s=e.selector?n.querySelector(e.selector):n;if(!s)return"";if("checkbox"===e.type){const o=!!e.attr&&s.hasAttribute(e.attr);return`<div class="jse-row"><label>${c(e.label)}</label><input type="checkbox" data-sidx="${t}" ${o?"checked":""}><label class="jse-toggle" data-for-sidx="${t}"></label></div>`}if("select"===e.type){const o=e.attr?s.getAttribute(e.attr)||"":"tagName"===e.prop?s.tagName:"",a=(e.options||[]).map(e=>`<option value="${e}" ${e===o?"selected":""}>${e||"(none)"}</option>`).join("");return`<div class="jse-row"><label>${c(e.label)}</label><select data-sidx="${t}">${a}</select></div>`}if("modal-toggle"===e.type){const s=n.querySelector(".modal-dialog"),o=n.querySelector(".shou-modal-close"),a=n.querySelector(".shou-modal-save");let l=!1;return"centered"===e.prop?l=s?.classList.contains("modal-dialog-centered"):"scrollable"===e.prop?l=s?.classList.contains("modal-dialog-scrollable"):"showClose"===e.prop?l=!o||"none"!==o.style.display:"showSave"===e.prop&&(l=!a||"none"!==a.style.display),`<div class="jse-row"><label>${c(e.label)}</label><input type="checkbox" data-sidx="${t}" data-modal-prop="${e.prop}" ${l?"checked":""}><label class="jse-toggle" data-for-sidx="${t}"></label></div>`}if("options"===e.type){const o=Array.from(s.querySelectorAll("option")).map((e,t)=>{const s=(e.getAttribute("value")||"").replace(/"/g,"&quot;"),o=(e.textContent||"").replace(/"/g,"&quot;");return`<div class="jse-opt-row" style="display:flex;gap:4px;margin-bottom:4px;align-items:center"><input type="text" data-opt-val="${t}" value="${s}" placeholder="${c("options.valuePlaceholder")}" style="flex:1;padding:4px 6px;border:1px solid var(--jse-border);border-radius:3px;background:var(--jse-bg);color:var(--jse-text);font-size:11px"><input type="text" data-opt-txt="${t}" value="${o}" placeholder="${c("options.textPlaceholder")}" style="flex:2;padding:4px 6px;border:1px solid var(--jse-border);border-radius:3px;background:var(--jse-bg);color:var(--jse-text);font-size:11px"><button data-opt-del="${t}" style="padding:2px 6px;border:1px solid var(--jse-border);border-radius:3px;background:var(--jse-bg);color:var(--jse-text);cursor:pointer;font-size:11px;line-height:1" title="${c("toolbar.delete")}">&times;</button></div>`}).join("");return`<div class="jse-row" style="flex-direction:column;align-items:stretch"><label>${c(e.label)}</label><div data-sidx="${t}" data-opt-editor="true" style="margin-top:4px">${o}<button data-opt-add style="width:100%;padding:4px;border:1px dashed var(--jse-border);border-radius:3px;background:transparent;color:var(--jse-accent);cursor:pointer;font-size:11px;margin-top:2px"${c("options.add")}</button></div></div>`}if("slides"===e.type){const s=n.querySelector(".carousel-inner"),o=(s?Array.from(s.querySelectorAll(".carousel-item")):[]).map((e,t)=>{const s=e.querySelector("img"),o=s?(s.getAttribute("src")||"").replace(/"/g,"&quot;"):"",a=s?(s.getAttribute("alt")||"").replace(/"/g,"&quot;"):"";return`<div class="jse-slide-row" data-slide-idx="${t}" style="display:flex;flex-direction:column;gap:4px;margin-bottom:8px;padding:8px;border:1px solid var(--jse-border);border-radius:4px;background:var(--jse-bg-alt)">\n                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:4px">\n                  <strong style="font-size:11px;color:var(--jse-text-muted)">Slide ${t+1}</strong>\n                  <button type="button" data-slide-del="${t}" style="padding:2px 6px;border:1px solid var(--jse-border);border-radius:3px;background:var(--jse-bg);color:var(--jse-text);cursor:pointer;font-size:11px;line-height:1" title="${c("toolbar.delete")}">&times;</button>\n                </div>\n                <input type="text" data-slide-src="${t}" value="${o}" placeholder="${c("setting.slideUrl")}" style="width:100%;padding:4px 6px;border:1px solid var(--jse-border);border-radius:3px;background:var(--jse-bg);color:var(--jse-text);font-size:11px">\n                <input type="text" data-slide-alt="${t}" value="${a}" placeholder="${c("setting.slideAlt")}" style="width:100%;padding:4px 6px;border:1px solid var(--jse-border);border-radius:3px;background:var(--jse-bg);color:var(--jse-text);font-size:11px">\n              </div>`}).join("");return`<div class="jse-row" style="flex-direction:column;align-items:stretch"><label>${c(e.label)}</label><div data-sidx="${t}" data-slides-editor="true" style="margin-top:4px">${o}<button data-slide-add style="width:100%;padding:6px;border:1px dashed var(--jse-border);border-radius:3px;background:transparent;color:var(--jse-accent);cursor:pointer;font-size:11px;margin-top:2px">${c("setting.addSlide")}</button></div></div>`}if("tabs"===e.type){const s=n.querySelector(".nav-tabs"),o=(s?Array.from(s.querySelectorAll(".nav-link")):[]).map((e,t)=>`<div class="jse-tab-row" data-tab-idx="${t}" style="display:flex;gap:8px;align-items:center;margin-bottom:6px">\n                <input type="text" data-tab-title="${t}" value="${(e.textContent||"").replace(/"/g,"&quot;")}" placeholder="${c("setting.tabTitle")}" style="flex:1;padding:6px 8px;border:1px solid var(--jse-border);border-radius:3px;background:var(--jse-bg);color:var(--jse-text);font-size:12px">\n                <button type="button" data-tab-del="${t}" style="padding:4px 8px;border:1px solid var(--jse-border);border-radius:3px;background:var(--jse-bg);color:var(--jse-text);cursor:pointer;font-size:12px;line-height:1" title="${c("toolbar.delete")}">&times;</button>\n              </div>`).join("");return`<div class="jse-row" style="flex-direction:column;align-items:stretch"><label>${c(e.label)}</label><div data-sidx="${t}" data-tabs-editor="true" style="margin-top:6px">${o}<button data-tab-add style="width:100%;padding:8px;border:1px dashed var(--jse-border);border-radius:3px;background:transparent;color:var(--jse-accent);cursor:pointer;font-size:12px;margin-top:4px">${c("setting.addTab")}</button></div><p style="font-size:10px;color:var(--jse-text-muted);margin-top:6px;margin-bottom:0">Edita el contenido de cada pestaña directamente en el canvas</p></div>`}if("accordion"===e.type){const s=n.querySelector(".accordion"),o=(s?Array.from(s.querySelectorAll(".accordion-item")):[]).map((e,t)=>{const s=e.querySelector(".accordion-button");return`<div class="jse-accordion-row" data-acc-idx="${t}" style="display:flex;gap:8px;align-items:center;margin-bottom:6px">\n                <input type="text" data-acc-title="${t}" value="${(s?.textContent||"").replace(/"/g,"&quot;")}" placeholder="${c("setting.sectionTitle")}" style="flex:1;padding:6px 8px;border:1px solid var(--jse-border);border-radius:3px;background:var(--jse-bg);color:var(--jse-text);font-size:12px">\n                <button type="button" data-acc-del="${t}" style="padding:4px 8px;border:1px solid var(--jse-border);border-radius:3px;background:var(--jse-bg);color:var(--jse-text);cursor:pointer;font-size:12px;line-height:1" title="${c("toolbar.delete")}">&times;</button>\n              </div>`}).join("");return`<div class="jse-row" style="flex-direction:column;align-items:stretch"><label>${c(e.label)}</label><div data-sidx="${t}" data-accordion-editor="true" style="margin-top:6px">${o}<button data-acc-add style="width:100%;padding:8px;border:1px dashed var(--jse-border);border-radius:3px;background:transparent;color:var(--jse-accent);cursor:pointer;font-size:12px;margin-top:4px">${c("setting.addSection")}</button></div><p style="font-size:10px;color:var(--jse-text-muted);margin-top:6px;margin-bottom:0">Haz click en una sección para editarla en el canvas</p></div>`}if("listgroup"===e.type){const s=n.querySelector(".list-group"),o=(s?Array.from(s.querySelectorAll(".list-group-item")):[]).map((e,t)=>`<div class="jse-listitem-row" data-listitem-idx="${t}" style="display:flex;gap:8px;align-items:center;margin-bottom:6px">\n                <input type="text" data-listitem-text="${t}" value="${(e.textContent||"").replace(/"/g,"&quot;")}" placeholder="${c("setting.itemText")}" style="flex:1;padding:6px 8px;border:1px solid var(--jse-border);border-radius:3px;background:var(--jse-bg);color:var(--jse-text);font-size:12px">\n                <button type="button" data-listitem-del="${t}" style="padding:4px 8px;border:1px solid var(--jse-border);border-radius:3px;background:var(--jse-bg);color:var(--jse-text);cursor:pointer;font-size:12px;line-height:1" title="${c("toolbar.delete")}">&times;</button>\n              </div>`).join("");return`<div class="jse-row" style="flex-direction:column;align-items:stretch"><label>${c(e.label)}</label><div data-sidx="${t}" data-listgroup-editor="true" style="margin-top:6px">${o}<button data-listitem-add style="width:100%;padding:8px;border:1px dashed var(--jse-border);border-radius:3px;background:transparent;color:var(--jse-accent);cursor:pointer;font-size:12px;margin-top:4px">${c("setting.addItem")}</button></div></div>`}if("breadcrumb"===e.type){const s=n.querySelector(".breadcrumb"),o=(s?Array.from(s.querySelectorAll(".breadcrumb-item")):[]).map((e,t)=>{const s=e.classList.contains("active"),o=e.querySelector("a"),a=(s?e.textContent:o?.textContent||"").replace(/"/g,"&quot;"),n=(o?.getAttribute("href")||"#").replace(/"/g,"&quot;");return`<div class="jse-breadcrumb-row" data-bc-idx="${t}" style="display:flex;flex-direction:column;gap:4px;margin-bottom:8px;padding:8px;border:1px solid var(--jse-border);border-radius:4px;background:var(--jse-bg-alt)">\n                <div style="display:flex;gap:6px;align-items:center">\n                  <input type="text" data-bc-text="${t}" value="${a}" placeholder="${c("setting.linkText")}" style="flex:1;padding:5px 8px;border:1px solid var(--jse-border);border-radius:3px;background:var(--jse-bg);color:var(--jse-text);font-size:12px">\n                  <button type="button" data-bc-del="${t}" style="padding:4px 8px;border:1px solid var(--jse-border);border-radius:3px;background:var(--jse-bg);color:var(--jse-text);cursor:pointer;font-size:12px;line-height:1" title="${c("toolbar.delete")}">&times;</button>\n                </div>\n                ${s?'<span style="font-size:10px;color:var(--jse-text-muted);padding:2px 0">Página actual (sin enlace)</span>':`<input type="text" data-bc-url="${t}" value="${n}" placeholder="${c("setting.linkUrl")}" style="width:100%;padding:5px 8px;border:1px solid var(--jse-border);border-radius:3px;background:var(--jse-bg);color:var(--jse-text);font-size:11px">`}\n              </div>`}).join("");return`<div class="jse-row" style="flex-direction:column;align-items:stretch"><label>${c(e.label)}</label><div data-sidx="${t}" data-breadcrumb-editor="true" style="margin-top:6px">${o}<button data-bc-add style="width:100%;padding:8px;border:1px dashed var(--jse-border);border-radius:3px;background:transparent;color:var(--jse-accent);cursor:pointer;font-size:12px;margin-top:4px">${c("setting.addLink")}</button></div><p style="font-size:10px;color:var(--jse-text-muted);margin-top:6px;margin-bottom:0">El último enlace se muestra como página actual</p></div>`}let o="";return e.attr?o=s.getAttribute(e.attr)||"":"textContent"===e.prop?o=s.textContent||"":"innerHTML"===e.prop&&(o=s.innerHTML||""),`<div class="jse-row"><label>${c(e.label)}</label><input type="text" data-sidx="${t}" value="${String(o).replace(/"/g,"&quot;")}"></div>`}).join("");else{const t=[...b._common||[],...b[o]||[]];if(!t.length)return void(e.innerHTML="");e.innerHTML=t.map(e=>{if(h.has(e)){return`<div class="jse-row"><label>${e}</label><input type="checkbox" data-attr="${e}" ${s.hasAttribute(e)?"checked":""}><label class="jse-toggle" data-for-attr="${e}"></label></div>`}return`<div class="jse-row"><label>${e}</label><input type="text" data-attr="${e}" value="${(s.getAttribute(e)||"").replace(/"/g,"&quot;")}"></div>`}).join("")}}insertBlock(e){const t=this.getBlockById(e);if(!t||!this.frame?.contentDocument)return;t.css&&this.injectBlockCSS(t);const s=this.frame.contentDocument.body,o=this._htmlToElement(t.html);o&&(o.setAttribute("data-jse-block",t.id),this.selectedElement?this.selectedElement.after(o):s.appendChild(o),this.syncToCode(),this.updateLayers())}insertBlockAt(e,t){const s=this.getBlockById(e);if(!s||!this.frame?.contentDocument)return;s.css&&this.injectBlockCSS(s);const o=this._htmlToElement(s.html);if(!o)return;o.setAttribute("data-jse-block",s.id);const a=this.frame.contentDocument.body;t===a?a.appendChild(o):t.after(o),this.syncToCode(),this.updateLayers()}getBlockById(e){for(const t of Object.values(this.blocks)){const s=t.find(t=>t.id===e);if(s)return s}return null}_findBlockRoot(e){let t=e;for(;t&&t!==this.frame?.contentDocument?.body;){if(t.getAttribute&&t.getAttribute("data-jse-block"))return t;t=t.parentElement}return null}_retagBlocks(){const e=this.frame?.contentDocument?.body;if(!e)return;const t=[];for(const e of Object.values(this.blocks))for(const s of e)t.push(s);for(const s of e.children)if(!s.getAttribute("data-jse-block"))for(const e of t){const t=document.createElement("div");t.innerHTML=e.html.trim();const o=t.firstElementChild;if(o&&(o.tagName===s.tagName&&o.className===s.className)){s.setAttribute("data-jse-block",e.id);break}}}_htmlToElement(e){const t=this.frame?.contentDocument;if(!t)return null;const s=t.createElement("div");return s.innerHTML=e.trim(),s.firstChild}injectBlockCSS(e){const t=this.frame?.contentDocument;if(!t)return;const s="jse-block-css-"+e.id;if(t.getElementById(s))return;const o=t.createElement("style");o.id=s,o.textContent=e.css,t.head.appendChild(o)}deleteSelected(){this.selectedElement&&(this.elementToolbar&&(this.elementToolbar.remove(),this.elementToolbar=null),this.selectedElement.remove(),this.selectedElement=null,this.updateSelectedInfo(),this.syncToCode(),this.updateLayers())}updateLayers(){if(!this.layersPanel||!this.frame?.contentDocument)return;const e=this.frame.contentDocument.body;this._outlinesActive&&!e.classList.contains("jse-show-outlines")&&e.classList.add("jse-show-outlines"),e.children.length?(this.layerIndex=0,this.layerElements=[],this.layersPanel.innerHTML=this.renderLayerNode(e,0),this.bindLayerEvents()):this.layersPanel.innerHTML='<div class="jse-empty">'+c("empty.dragElements")+"</div>"}renderLayerNode(e,t){if(1!==e.nodeType||["SCRIPT","STYLE","LINK"].includes(e.tagName))return"";if(e.classList.contains("jse-drop-indicator")||e.classList.contains("jse-element-toolbar"))return"";const s=e.tagName.toLowerCase(),o=e.className?`.${String(e.className).split(" ")[0]}`:"",a=this.layerIndex++;this.layerElements.push(e);return`<div class="jse-layer" data-layer-idx="${a}" draggable="true">${t>0?`<span class="jse-layer-indent" style="width:${12*t}px"></span>`:""}<span class="jse-layer-tag">&lt;${s}&gt;</span>${o?`<span style="opacity:0.6">${o}</span>`:""}</div>${Array.from(e.children).map(e=>this.renderLayerNode(e,t+1)).join("")}`}bindLayerEvents(){let e=null;s(".jse-layer",this.layersPanel).forEach(t=>{t.addEventListener("click",()=>{const e=parseInt(t.dataset.layerIdx),s=this.layerElements[e];s&&this.selectElement(s)}),t.addEventListener("dragstart",s=>{e=parseInt(t.dataset.layerIdx),t.classList.add("jse-layer-dragging"),s.dataTransfer.effectAllowed="move",s.dataTransfer.setData("text/plain",e)}),t.addEventListener("dragover",e=>{e.preventDefault(),e.dataTransfer.dropEffect="move";const s=t.getBoundingClientRect(),o=e.clientY-s.top,a=s.height/3;t.classList.remove("jse-layer-drop-before","jse-layer-drop-after","jse-layer-drop-inside"),o<a?t.classList.add("jse-layer-drop-before"):o>2*a?t.classList.add("jse-layer-drop-after"):t.classList.add("jse-layer-drop-inside")}),t.addEventListener("dragleave",()=>{t.classList.remove("jse-layer-drop-before","jse-layer-drop-after","jse-layer-drop-inside")}),t.addEventListener("drop",s=>{s.preventDefault(),t.classList.remove("jse-layer-drop-before","jse-layer-drop-after","jse-layer-drop-inside");const o=parseInt(t.dataset.layerIdx);if(null===e||e===o)return;const a=this.layerElements[e],n=this.layerElements[o];if(!a||!n)return;if(a.contains(n))return;const l=t.getBoundingClientRect(),i=s.clientY-l.top,r=l.height/3;if(i<r)n.parentNode.insertBefore(a,n);else if(i>2*r)n.parentNode.insertBefore(a,n.nextSibling);else{!["IMG","BR","HR","INPUT","TEXTAREA","SELECT","BUTTON"].includes(n.tagName)?n.appendChild(a):n.parentNode.insertBefore(a,n.nextSibling)}this.syncToCode(),this.updateLayers(),this.selectElement(a)}),t.addEventListener("dragend",()=>{t.classList.remove("jse-layer-dragging"),e=null})})}highlightLayerForElement(e){if(s(".jse-layer",this.layersPanel).forEach(e=>e.classList.remove("selected")),!e)return;const o=this.layerElements?.indexOf(e);if(o>=0){const e=t(`.jse-layer[data-layer-idx="${o}"]`,this.layersPanel);e&&e.classList.add("selected")}}setCodeLang(e){this.currentLang=e,Object.entries(this.codeEditors).forEach(([t,s])=>{s.wrapper?.classList.toggle("active",t===e)})}handleCodeKeydown(e,t){const s=this.codeEditors[t]?.textarea;if(!s)return;const o=e.ctrlKey||e.metaKey;if(o&&e.shiftKey&&("["===e.key||"BracketLeft"===e.code)){e.preventDefault();const o=s.value.substring(0,s.selectionStart).split("\n").length-1,a=(this._displayToRealMap[t]||[])[o]??o;return void(this._foldRegions[t].find(e=>e.start===a)&&!this._foldState[t].has(a)&&(this._toggleFold(t,a),s.value=this._displayCode[t]))}if(o&&e.shiftKey&&("]"===e.key||"BracketRight"===e.code)){e.preventDefault();const o=s.value.substring(0,s.selectionStart).split("\n").length-1,a=(this._displayToRealMap[t]||[])[o]??o;return void(this._foldState[t].has(a)&&(this._toggleFold(t,a),s.value=this._displayCode[t]))}if(o&&"z"===e.key)return e.preventDefault(),void(e.shiftKey?this.redo():this.undo());if(o&&"y"===e.key)return e.preventDefault(),void this.redo();if("Tab"===e.key){e.preventDefault();const{start:o,end:a}=n(s),i="  ";s.value=s.value.substring(0,o)+i+s.value.substring(a),l(s,o+2),this.code[t]=this._foldState[t].size>0?this._displayToRealCode(t,s.value):s.value,this.updateCodeEditor(t)}if("Enter"===e.key){e.preventDefault();const{start:o}=n(s),a=s.value.substring(0,o),i=s.value.substring(o),r=a.lastIndexOf("\n")+1,c=a.substring(r).match(/^[ ]*/)[0],d=a.trim().slice(-1),p=["{","(","[",":"].includes(d)?"  ":"";s.value=a+"\n"+c+p+i,l(s,o+1+c.length+p.length),this.code[t]=this._foldState[t].size>0?this._displayToRealCode(t,s.value):s.value,this.updateCodeEditor(t)}}updateCodeEditor(e){const t=this.codeEditors[e];if(!t)return;this._foldRegions[e]=this._detectFoldRegions(this.code[e]||"",e);for(const t of this._foldState[e])this._foldRegions[e].some(e=>e.start===t)||this._foldState[e].delete(t);const s=this._buildDisplayCode(e);t.highlight&&(t.highlight.innerHTML=m(s,e)||"<br>"),this._renderFoldableLines(e)}updateAllCodeEditors(){["html","css","js"].forEach(e=>{if(this.codeEditors[e]?.textarea){this._foldRegions[e]=this._detectFoldRegions(this.code[e]||"",e);for(const t of this._foldState[e])this._foldRegions[e].some(e=>e.start===t)||this._foldState[e].delete(t);const t=this._buildDisplayCode(e);this.codeEditors[e].textarea.value=t}this.updateCodeEditor(e)})}getCleanBodyHtml(){const e=this.frame?.contentDocument?.body;if(!e)return"";const t=e.cloneNode(!0);return t.querySelectorAll(".jse-element-toolbar,.jse-drop-indicator").forEach(e=>e.remove()),t.querySelectorAll("[data-selected],[data-hover]").forEach(e=>{e.removeAttribute("data-selected"),e.removeAttribute("data-hover")}),this.formatHtml(t.innerHTML)}formatHtml(e){if(!e||!e.trim())return"";const t=new Set(["area","base","br","col","embed","hr","img","input","link","meta","source","track","wbr"]),s=new Set(["a","abbr","b","bdi","bdo","br","cite","code","em","i","img","input","kbd","label","mark","q","s","samp","small","span","strong","sub","sup","time","u","var"]),o=new Set(["script","style","pre","code","textarea"]);let a="",n=0;const l=()=>"  ".repeat(n),i=e.match(/<!--[\s\S]*?-->|<[^>]+>|[^<]+/g)||[];let r=!1,c="";for(let e=0;e<i.length;e++){const d=i[e];if(d.startsWith("\x3c!--"))a+=l()+d.trim()+"\n";else if(r)d.match(new RegExp(`^<\\/${c}`,"i"))?(r=!1,n=Math.max(0,n-1),a+=l()+d.trim()+"\n"):a+=d;else if(d.startsWith("<")){const p=d.trim(),h=p.match(/^<\/?([a-zA-Z][a-zA-Z0-9]*)/);if(!h){a+=p;continue}const b=h[1].toLowerCase(),u=p.startsWith("</"),g=p.endsWith("/>")||t.has(b),m=s.has(b);if(!u&&o.has(b)&&!g){a+=l()+p+"\n",n++,r=!0,c=b;continue}if(u)n=Math.max(0,n-1),m?(a=a.replace(/\n$/,""),a+=p+"\n"):a+=l()+p+"\n";else if(g||m){a+=l()+p;const t=i[e+1];m&&!g&&t&&!t.startsWith("<")?a+="":a+="\n"}else a+=l()+p+"\n",n++}else{const e=d.trim();if(!e)continue;a.length>0&&!a.endsWith("\n")?a+=e:a+=l()+e+"\n"}}return a.replace(/\n{3,}/g,"\n\n").trim()}pushHistory(){const e=JSON.stringify(this.code);this.historyIndex>=0&&this.history[this.historyIndex]===e||(this.history=this.history.slice(0,this.historyIndex+1),this.history.push(e),this.history.length>this.maxHistory&&this.history.shift(),this.historyIndex=this.history.length-1)}undo(){this.historyIndex<=0||(this.historyIndex--,this.restoreSnapshot(JSON.parse(this.history[this.historyIndex])))}redo(){this.historyIndex>=this.history.length-1||(this.historyIndex++,this.restoreSnapshot(JSON.parse(this.history[this.historyIndex])))}restoreSnapshot(e){this.code.html=e.html,this.code.css=e.css,this.code.js=e.js,["html","css","js"].forEach(e=>{this.codeEditors[e]?.textarea&&(this.codeEditors[e].textarea.value=this.code[e]),this.updateCodeEditor(e)});const t=this.frame?.contentDocument;if(t?.body){t.body.innerHTML=this.code.html;let e=t.getElementById("jse-custom-css");e||(e=t.createElement("style"),e.id="jse-custom-css",t.head.appendChild(e)),e.textContent=this.code.css||""}this.selectElement(null),this.updateLayers(),this.saveToStorage()}syncToCode(){const e=this.getCleanBodyHtml();this.code.html=e,this.codeEditors.html?.textarea&&(this.codeEditors.html.textarea.value=e),this.updateCodeEditor("html"),this.pushHistory(),this.saveToStorage()}syncFromCode(){const e=this.frame?.contentDocument;if(!e)return;e.body&&(e.body.innerHTML=this.code.html,this.updateLayers());let t=e.getElementById("jse-custom-css");t||(t=e.createElement("style"),t.id="jse-custom-css",e.head.appendChild(t)),t.textContent=this.code.css||""}toggleOutlines(e){this._outlinesActive=e;const t=this.frame?.contentDocument;if(t){t.body.classList.toggle("jse-show-outlines",e);try{localStorage.setItem(this.config.storagePrefix+"outlines",e?"1":"")}catch(e){}}}saveToStorage(){const e=this.config.storagePrefix;try{localStorage.setItem(e+"html",this.code.html),localStorage.setItem(e+"css",this.code.css),localStorage.setItem(e+"js",this.code.js),localStorage.setItem(e+"theme",this.config.theme)}catch(e){}}stripEditorElements(e){if(!e)return e;const t=document.createElement("div");return t.innerHTML=e,t.querySelectorAll(".jse-element-toolbar,.jse-drop-indicator").forEach(e=>e.remove()),t.querySelectorAll("[data-selected],[data-hover]").forEach(e=>{e.removeAttribute("data-selected"),e.removeAttribute("data-hover")}),t.innerHTML}loadFromStorage(){const e=this.config.storagePrefix;try{this.code.html=this.stripEditorElements(localStorage.getItem(e+"html")||""),this.code.css=localStorage.getItem(e+"css")||"",this.code.js=localStorage.getItem(e+"js")||"";const t=localStorage.getItem(e+"theme");t&&!this._themeFromConfig&&this.setTheme(t);if(localStorage.getItem(e+"outlines")){this._outlinesActive=!0;const e=this.root?.querySelector('.jse-toggle-btn[data-toggle="outlines"]');e&&e.classList.add("active")}}catch(e){}this.updateAllCodeEditors(),setTimeout(()=>{this.code.html&&this.frame?.contentDocument?.body&&(this.frame.contentDocument.body.innerHTML=this.code.html,this._retagBlocks(),this.updateLayers()),this.pushHistory()},200)}newProject(){confirm(c("confirm.newProject"))&&(this.code={html:"",css:"",js:""},this.updateAllCodeEditors(),this.frame?.contentDocument?.body&&(this.frame.contentDocument.body.innerHTML=""),this.updateLayers(),this.saveToStorage())}save(){const e=this._buildSaveData();"remote"===this.config.saveTarget&&this.config.saveEndpoint?this._saveRemote(e):this._saveLocal(e)}_buildSaveData(){const e=this.config.saveFilename||"proyecto";if("json"===this.config.saveFormat){const t=this.code.html.replace(/\s*data-jse-block="[^"]*"/g,"");return{content:JSON.stringify({html:t,css:this.code.css,js:this.code.js},null,2),filename:e+".json",type:"application/json"}}return{content:this.generateFullHtml(),filename:e+".html",type:"text/html"}}_saveLocal(e){this.download(e.content,e.filename,e.type)}_saveRemote(e){const t="json"===this.config.saveFormat?e.content:JSON.stringify({html:e.content});fetch(this.config.saveEndpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:t}).then(e=>{if(!e.ok)throw new Error(`HTTP ${e.status}`);return e.json().catch(()=>({}))}).then(e=>{this.config.onSaveSuccess&&this.config.onSaveSuccess(e)}).catch(e=>{this.config.onSaveError?this.config.onSaveError(e):console.error("Save failed:",e)})}preview(){const e=this.generateFullHtml(),t=new Blob([e],{type:"text/html"});window.open(URL.createObjectURL(t),"_blank")}exportHtml(){this.save()}generateFullHtml(){const e=this.code.html.replace(/\s*data-jse-block="[^"]*"/g,"");return`<!DOCTYPE html>\n<html lang="es">\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width,initial-scale=1">\n  <title>Mi Proyecto</title>\n  <link href="${this.config.bootstrapCss}" rel="stylesheet">\n  <style>${this.code.css}</style>\n</head>\n<body>\n${e}\n  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"><\/script>\n  <script>${this.code.js}<\/script>\n</body>\n</html>`}importHtml(e){const t=(new DOMParser).parseFromString(e,"text/html");let s="";t.querySelectorAll("style").forEach(e=>s+=e.textContent+"\n");let o="";t.querySelectorAll("script:not([src])").forEach(e=>o+=e.textContent+"\n"),t.body.querySelectorAll("script").forEach(e=>e.remove());const a=t.body.innerHTML.trim();this.code={html:a,css:s.trim(),js:o.trim()},this.updateAllCodeEditors(),this.frame?.contentDocument?.body&&(this.frame.contentDocument.body.innerHTML=a),this.updateLayers(),this.saveToStorage()}download(e,t,s){const o=new Blob([e],{type:s}),a=URL.createObjectURL(o),n=document.createElement("a");n.href=a,n.download=t,n.click(),URL.revokeObjectURL(a)}setTheme(e){this.config.theme=e,this.root?.classList.remove("theme-dark","theme-light"),this.root?.classList.add(`theme-${e}`),this.saveToStorage()}toggleTheme(){this.setTheme("dark"===this.config.theme?"light":"dark")}setLang(e){if(!r[e])return;i=e,this.config.lang=e;const t={...this.code};this.render(),this.cacheElements(),this.bindEvents(),this.code=t,this.updateAllCodeEditors(),this.initFrame(),this.loadFromStorage()}getLang(){return i}setSaveFormat(e){"html"!==e&&"json"!==e||(this.config.saveFormat=e)}setSaveTarget(e,t){"local"!==e&&"remote"!==e||(this.config.saveTarget=e),void 0!==t&&(this.config.saveEndpoint=t)}getHtml(){return this.code.html}getCss(){return this.code.css}getJs(){return this.code.js}getCode(){return{...this.code}}setHtml(e){this.code.html=e,this.updateAllCodeEditors(),this.syncFromCode()}setCss(e){this.code.css=e,this.updateAllCodeEditors()}setJs(e){this.code.js=e,this.updateAllCodeEditors()}setCode(e){void 0!==e.html&&(this.code.html=e.html),void 0!==e.css&&(this.code.css=e.css),void 0!==e.js&&(this.code.js=e.js),this.updateAllCodeEditors(),this.syncFromCode()}bindToForm(e,t={}){const s="string"==typeof e?document.querySelector(e):e;if(!s||"FORM"!==s.tagName)return;const o=t.field||null,a=t.htmlField||"editor_html",n=t.cssField||"editor_css",l=t.jsField||"editor_js",i=e=>{let t=s.querySelector(`input[name="${e}"]`);return t||(t=document.createElement("input"),t.type="hidden",t.name=e,s.appendChild(t)),t};this._formBinding&&this._formBinding.form.removeEventListener("submit",this._formBinding.handler);const r=()=>{const e=this.code.html.replace(/\s*data-jse-block="[^"]*"/g,"");o?i(o).value=JSON.stringify({html:e,css:this.code.css,js:this.code.js}):(i(a).value=e,i(n).value=this.code.css,i(l).value=this.code.js)};s.addEventListener("submit",r),this._formBinding={form:s,handler:r}}unbindForm(){this._formBinding&&(this._formBinding.form.removeEventListener("submit",this._formBinding.handler),this._formBinding=null)}destroy(){this.unbindForm(),this.container&&(this.container.innerHTML="")}}const y={version:"1.0.0",Editor:v,Blocks:g,init:(e,t)=>new v(e,t),instance:null};"undefined"!=typeof module&&module.exports?module.exports=y:e.ShouEditor=y}("undefined"!=typeof window?window:this);